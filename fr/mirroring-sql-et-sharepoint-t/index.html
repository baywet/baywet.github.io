<!doctype html><html lang=fr dir=ltr itemscope itemtype=https://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Mirroring SQL et SharePoint : Tips & Piège</title><meta name=author content="Vincent Biret"><meta name=description content="Chose évidente, les technologies SharePoint sont intimement liées à SQL Server. Cependant les administrateurs SharePoint ne sont pas toujours familiers à SQL et vice versa.
Depuis SharePoint 2010, il..."><meta name=generator content="Hugo 0.74.3"><meta itemprop=name content="Mirroring SQL et SharePoint : Tips & Piège"><meta itemprop=description content="Chose évidente, les technologies SharePoint sont intimement liées à SQL Server. Cependant les administrateurs SharePoint ne sont pas toujours familiers à SQL et vice versa.
Depuis SharePoint 2010, il..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Mirroring SQL et SharePoint : Tips & Piège"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/fr/mirroring-sql-et-sharepoint-t/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="Chose évidente, les technologies SharePoint sont intimement liées à SQL Server. Cependant les administrateurs SharePoint ne sont pas toujours familiers à SQL et vice versa.
Depuis SharePoint 2010, il..."><meta property="og:site_name" content="Le blog de baywet"><meta property="og:updated_time" content="2020-09-13T11:06:20-04:00"><meta property="article:published_time" content="2011-04-28T15:34:00+00:00"><meta property="article:modified_time" content="2020-09-13T11:06:20-04:00"><meta property="article:section" content><meta property="article:tag" content="mirroring"><meta property="article:tag" content="sql"><meta property="article:tag" content="piege"><meta property="article:tag" content="miroir"><meta property="article:tag" content="tips"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Mirroring SQL et SharePoint : Tips & Piège"><meta name=twitter:description content="Chose évidente, les technologies SharePoint sont intimement liées à SQL Server. Cependant les administrateurs SharePoint ne sont pas toujours familiers à SQL et vice versa.
Depuis SharePoint 2010, il..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176061333-1','auto');ga('send','pageview');</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/fr><div class="title is-4">&nbsp;Le blog de baywet</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span><span></span><span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=/en>English</a></div></div></div></nav><section class=section style=flex:1><div class=container><h1 class=title>Mirroring SQL et SharePoint : Tips & Piège</h1><p class=subtitle>Apr 28, 2011</p><div class=content><p><img src=./SQLServer2008R2_5F00_2.png alt=SQLServer2008R2_5F00_2.png></p><p>Chose évidente, les technologies SharePoint sont intimement liées à SQL Server. Cependant les administrateurs SharePoint ne sont pas toujours familiers à SQL et vice versa.</p><p>Depuis SharePoint 2010, il est possible d’utiliser pour les bases de données, du mirroring SQL (mise en miroir de base de données). Ceci permet de faire en sorte que votre ferme soit plus tolérante à la panne et facilite aussi les maintenances.</p><p>Le principe est simple SharePoint utilise principalement une instance SQL pour ses bases de données et lorsque cette instance n’est pas disponible, il contacte l’instance de secours, le mécanisme est transparent et automatique et ne provoque pas d’interruption de service côté utilisateur final.</p><p>Les instances (PARTNERS) quant à elles se chargent de synchroniser les copies de bases de données et d’élire le serveur principal. Par exemple, si vous redémarrez un serveur, l’instance sait qu’elle va s’arrêter et prévenir l’autre instance qui héberge la copie pour qu’elle passe en instance principale. Autre cas de figure, si un de vos serveurs crash, l’autre prend le relais. Vous pouvez aussi demander la bascule manuellement.</p><p>Notes : La base de données « active » ou principale apparaitra normalement dans SQL Management Studio, celle « en attente » (la copie donc) apparaitra comme une base de données en restauration. Une troisième instance de WITNESS (témoin) peut être utilisée pour « surveiller » l’activité des deux autres et « piloter » les communications. Ce n’est pas obligatoire mais cela permet une meilleure fiabilité.</p><p>Comment cela fonctionne ? Le but de cet article n’est pas de faire un howto, deux articles (en anglais) le font très bien (un pour la partie SQL et un pour la partie SharePoint). Le but ici est d’indiquer l’idée générale du concept et de vous parler de certains pièges.</p><p><a href=https://www.sharepointbandit.com/2010/08/configure-database-mirroring-on.html>https://www.sharepointbandit.com/2010/08/configure-database-mirroring-on.html</a></p><p><a href="https://www.toddklindt.com/blog/Lists/Posts/Post.aspx?ID=202">https://www.toddklindt.com/blog/Lists/Posts/Post.aspx?ID=202</a></p><p>Remarque, pour la mise en miroir des bases de données, après avoir créé les endpoints, j’ai préféré utiliser l’assistant graphique de SQL Management Studio depuis la base de données principale, c’est plus simple et plus rapide.</p><p>Pour revenir au fonctionnement de la mise en miroir, vous verrez que la procédure vous demande de passer les bases de données en « recovery mode : full ». Le fait de passer la méthode de récupération des données à « complet » implique que pour la base de donnée concernée, l’instance SQL va conserver l’INTEGRALITE des logs transactionnels sans JAMAIS les vider, et ce même si elle n’en a plus besoin. (Ceci permet de retracer et éventuellement de pouvoir rejouer toutes les requêtes jouées depuis)</p><p>Le problème étant que SharePoint est sans cesse en train d’exécuter des requêtes SQL, même quand il ne se passe « rien », ainsi on arrive vite à remplir un disque dur et à dégrader les services SharePoint.</p><p>Pas de panique deux solutions s’offrent à vous :</p><ul><li><p>Tout n’est pas encore perdu : dans ce cas un backup des logs transactionnels, permet de les archiver. Les bests pratices vous demandent de les garder à vie pour avoir plus de chances de restaurer la base de données en cas de sinistre à partir de n’importe quel (ancien ou non) backup de base. En fait, la partie archivée des logs correspond à la partie dont SQL Server n’a plus besoin pour l’exploitation courante de la base de données. Les logs seront ainsi tronqués, la partie tronquée archivée et compressée dans un fichier de backup, libre à vous de le supprimer ou de le stocker ailleurs pour faire de la place.</p></li><li><p>Le disque est déjà plein : Dans ce cas basculez la base de données sur l’instance principale si elle n’est pas déjà en condition normale. Arrêtez la mise en miroir de la base. Supprimez la copie en restauration. Passez la base principale en mode de récupération Simple. Effectuez une compression (SRHINK) de la base de données si sa taille ne s’est pas réduite automatiquement. Repassez là en mode complet de récupération Complet et remontez la mise en miroir.</p></li></ul><p>L’avantage avec cette seconde astuce c’est qu’elle n’interrompt même pas le service (car vous avez basculé sur l’instance principale) et qu’elle ne nécessite pas d’espace disque supplémentaire pour créer le backup des logs.</p><p>Attention tout de même, ceci est une méthode de secours, l’idéal reste encore de faire des backups des logs régulièrement.</p><p>Ce qu’il faut retenir pour résumer :</p><ul><li><p>Le mirroring de bases pour SharePoint, c’est très pratique</p></li><li><p>Attention tout de même SharePoint étant gourmand en termes d’activité de la base de données, les disques durs risquent de se remplir vite avec des fichiers de logs</p></li><li><p>Les limites de fichiers de base de données ne fonctionnent (ou du moins ne permettront pas à votre ferme de fonctionner correctement lorsque les limites seront atteintes) pas puisque en mode de récupération complet (nécessaire à la mise en miroir), SQL Server conserve les logs transactionnels</p></li><li><p>Pour éviter les ennuis pensez à faire des backups régulièrement des fichiers de logs transactionnels.</p></li><li><p>Si le disque est déjà plein utilisez cette astuce, mais seulement dans ce cas-là.</p></li></ul><p>A titre d’exemple, en 2 mois d’activité d’une ferme de taille moyenne de tests, la base de données de configuration est montée à plus de 20Go (dont plus de 19Go de logs transactionnels)</p></div><br><p class=heading>Edité la dernière fois le
<a href=https://github.com/baywet/blogsource/commit/568d5785231309e09639a038db8aa4f4e71568c3>13 Sep 2020</a> par <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/fr/tags/mirroring><span class=tag>Mirroring</span></a></div><div class=control><a href=/fr/tags/sql><span class=tag>Sql</span></a></div><div class=control><a href=/fr/tags/piege><span class=tag>Piege</span></a></div><div class=control><a href=/fr/tags/miroir><span class=tag>Miroir</span></a></div><div class=control><a href=/fr/tags/tips><span class=tag>Tips</span></a></div><div class=control><a href=/fr/tags/sharepoint><span class=tag>Sharepoint</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/afterworks-des-communautes-mic/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span><span class="is-hidden-touch is-hidden-desktop-only">Afterworks des communautés Microsoft à Aix-En-Provence</span>
<span class="is-hidden-touch is-hidden-widescreen">Afterworks des communautés Microsoft à Aix-En-Provence</span>
<span class="is-hidden-mobile is-hidden-desktop">Afterworks des communautés Microsoft à...</span>
<span class=is-hidden-tablet>Afterworks des communautés Microsoft à...</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/webconference-sur-la-securite/><span class="is-hidden-touch is-hidden-desktop-only">WebConférence sur la sécurité avec la gamme ForeFront 2010</span>
<span class="is-hidden-touch is-hidden-widescreen">WebConférence sur la sécurité avec la gamme ForeFront 2010</span>
<span class="is-hidden-mobile is-hidden-desktop">WebConférence sur la sécurité avec la gamme...</span>
<span class=is-hidden-tablet>WebConférence sur la sécurité avec la...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/fr/mirroring-sql-et-sharepoint-t/";this.page.identifier=window.location.pathname;};(function(){var d=document,s=d.createElement('script');s.src='https://baywet.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><div class=container><nav class=panel><p class=panel-heading>Related</p><a class=panel-block href=https://baywet.github.io/fr/webconference-sur-la-securite/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>WebConférence sur la sécurité avec la gamme ForeFront 2010&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/topologie-des-fermes-sharepoin/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Topologie des fermes SharePoint et déploiement de ForeFront Protection for SharePoint&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/vue-densemble-des-services-de/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Vue d’ensemble des services de conversion des documents dans SharePoint 2010&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/requtage-active-directory-depu/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Requêtage Active Directory depuis SharePoint.&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/feedback-msday-aix-en-provence/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Feedback MSDay Aix-En-Provence 30/09/10&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/ajouter-un-nouvel-administrate/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Ajouter un nouvel administrateur de ferme SharePoint pouvant éxécuter la console PowerShell sans encombres&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/configuration-du-service-profi/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Configuration du service profil utilisateur sous SharePoint 2010/2007&nbsp;<div class=tag>Sharepoint</div></span></a></nav></div></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/fr><span class=icon><i class="fa fa-home"></i></span></a>&nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>