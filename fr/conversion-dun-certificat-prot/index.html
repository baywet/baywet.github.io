<!doctype html><html lang=fr dir=ltr itemscope itemtype=https://schema.org/Article>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Conversion d’un certificat protégé par mot de passe (pfx) en certificat non protégé (snk)</title>
<meta name=author content="Vincent Biret">
<meta name=description content="Au travail je suis en train de mettre en place du build automatisé pour des projets SharePoint (full trust) sur visual studio online. (Attendez-vous à voir plusieurs articles à ce sujet au fur et à...">
<meta name=generator content="Hugo 0.88.1">
<meta itemprop=name content="Conversion d’un certificat protégé par mot de passe (pfx) en certificat non protégé (snk)">
<meta itemprop=description content="Au travail je suis en train de mettre en place du build automatisé pour des projets SharePoint (full trust) sur visual studio online. (Attendez-vous à voir plusieurs articles à ce sujet au fur et à...">
<meta itemprop=image content="/img/logo.svg">
<meta property="og:title" content="Conversion d’un certificat protégé par mot de passe (pfx) en certificat non protégé (snk)">
<meta property="og:type" content="article">
<meta property="og:url" content="https://baywet.github.io/fr/conversion-dun-certificat-prot/">
<meta property="og:image" content="/img/logo.svg">
<meta property="og:description" content="Au travail je suis en train de mettre en place du build automatisé pour des projets SharePoint (full trust) sur visual studio online. (Attendez-vous à voir plusieurs articles à ce sujet au fur et à...">
<meta property="og:site_name" content="Le blog de baywet">
<meta property="og:updated_time" content="2021-09-06T09:54:53-07:00">
<meta property="article:published_time" content="2014-10-04T01:05:51+00:00">
<meta property="article:modified_time" content="2021-09-06T09:54:53-07:00">
<meta property="article:section" content>
<meta property="article:tag" content="build">
<meta property="article:tag" content="alm">
<meta property="article:tag" content="visual studio">
<meta property="article:tag" content="sharepoint">
<meta name=twitter:card content="summary">
<meta name=twitter:site content>
<meta name=twitter:title content="Conversion d’un certificat protégé par mot de passe (pfx) en certificat non protégé (snk)">
<meta name=twitter:description content="Au travail je suis en train de mettre en place du build automatisé pour des projets SharePoint (full trust) sur visual studio online. (Attendez-vous à voir plusieurs articles à ce sujet au fur et à...">
<meta name=twitter:creator content>
<meta name=twitter:image:src content="/img/logo.svg">
<link rel=stylesheet type=text/css href=/css/capsule.min.css>
<script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-176061333-1','auto'),ga('send','pageview')</script>
<link rel=apple-touch-icon href=/img/apple-touch-icon.png>
<link rel=icon href=/img/favicon.ico>
</head>
<body style=min-height:100vh;display:flex;flex-direction:column>
<nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation">
<div class=container>
<div class=navbar-brand>
<a class=navbar-item href=/fr>
<div class="title is-4">&nbsp;Le blog de baywet</div>
</a>
<label class="button navbar-burger is-white" for=navbar-burger-state>
<span></span>
<span></span>
<span></span>
</label>
</div>
<input type=checkbox id=navbar-burger-state>
<div class=navbar-menu>
<div class=navbar-end>
<a class=navbar-item href=https://baywet.github.io/converting-a-protected-by-pass/>English</a>
</div>
</div>
</div>
</nav>
<section class=section style=flex:1>
<div class=container>
<h1 class=title>Conversion d’un certificat protégé par mot de passe (pfx) en certificat non protégé (snk)</h1>
<p class=subtitle>Oct 4, 2014</p>
<div class=content>
<p>Au travail je suis en train de mettre en place du <strong>build automatisé pour des projets SharePoint</strong> (full trust) sur visual studio online. (Attendez-vous à voir plusieurs articles à ce sujet au fur et à mesure que je rencontre et résous des erreurs)</p>
<p>Qui dit développement SharePoint dit <strong>assemblies signés par un certificat</strong>. Lorsque l’on initialise le projet on a deux options :</p>
<ul>
<li>Certificat est protégé par mot de passe : (extension pfx) c’était au début du tooling SharePoint, ou bien si vous avez monté la structure de solution (visual studio) vous-même avec plusieurs assemblies.</li>
<li>Certificat non protégé : (extension snk) option par défaut du tooling depuis quelques années</li>
</ul>
<p><strong>Dans mon cas le certificat était protégé par mot de passe</strong>, cependant le problème c’est qu’il faut taper ce mot de passe lorsque l’on veut compiler pour la première fois les sources sur une nouvelle machine. Ce n’est vraiment pas pratique lorsque l’on fait du build automatisé (pas d’humain pour taper un mot de passe lors de la compilation). <strong>Ce qui nous donne des messages d’erreur de ce genre.</strong></p>
<p><em>Cannot import the following key file: cert.pfx. The key file may be password protected. To correct this, try to import the certificate again or manually install the certificate to the Strong Name CSP with the following key container name: VS_KEY_XXXXXXXXXXXXXXX</em></p>
<p>C’est d’autant moins pratique lorsque l’on essaie de configurer ça avec les hosted build machines. Ces <strong>machines sont des machines pré configurées par Microsoft pour éviter d’avoir à monter sa propre machine de build</strong>. (on ne peut donc pas les administrer).</p>
<p><strong>Le framework msbuild ne fournit pas de manière simple de rentrer le mot de passe</strong> et l’outil en ligne de commande sn.exe (sert à importer les certificats dans le store de la machine) prompte lui aussi pour le mot de passe. En fait c’est logique : <strong>un mot de passe doit être mémorisé mais écrit nulle part</strong>. (principe de sécurité de base).</p>
<p>Il me restait donc à <strong>supprimer le mot de passe du certificat</strong>, seulement <strong>l’interface visual studio</strong> ne <strong>permet pas d’effectuer cela</strong>. Il n’y a qu’à <strong>générer un nouveau certificat dans ce cas</strong> ? Surtout pas ! <strong>Cela va changer la public key du nom d’assembly</strong> et potentiellement poser des problèmes pour tous les éléments enregistrés en base de données après la mise à jour ! (je pense notamment aux event receivers).</p>
<p>La solution ? <strong>Convertir le certificat grâce à un bout de code</strong> (exécuté dans une app console) trouvé sur pastebin <a href=https://pastebin.com/dpMxqsK4>https://pastebin.com/dpMxqsK4</a></p>
<p>X509Certificate2 cert = new X509Certificate2(@&ldquo;KEY.pfx&rdquo;, &ldquo;pfxPassword&rdquo;, X509KeyStorageFlags.Exportable | X509KeyStorageFlags.PersistKeySet);</p>
<p>RSACryptoServiceProvider provider = (RSACryptoServiceProvider) cert.PrivateKey;</p>
<p>byte[] array = provider.ExportCspBlob(!provider.PublicOnly);</p>
<p>using (FileStream fs = new FileStream(&ldquo;FileName.snk&rdquo;, FileMode.Create,     FileAccess.Write))</p>
<p>{</p>
<p>fs.Write(array, 0, array.Length);</p>
<p>}</p>
<p>En espérant que cela vous fasse gagner du temps dans la mise en place de vos builds automatisés sur visual studio online.</p>
<p>PS : idéalement votre entreprise devrait acheter un certificat intermédiaire public et monter une PKI. A partir de cette PKI vous devriez générer vos certificats protégés par mot de passe. Ces certificats devraient être importés une fois (via GPO si possible) sur les machines des développeurs et les machines de build. Cela permettrait de :</p>
<ul>
<li>garder la clef privée protégée même en cas de vol des sources</li>
<li>ne pas avoir à donner le mot de passe aux développeurs ou à le mettre dans un script</li>
<li>permettre à vos clients de s’assurer que l’assembly qu’ils reçoivent a bien été publié par vous et non par un attaquant</li>
<li>mettre en place du build automatisé (sur vos machines uniquement pas celles hébergées par VS online)</li>
</ul>
<p>(voir authenticode <a href=https://msdn.microsoft.com/fr-fr/library/ms172240.aspx>https://msdn.microsoft.com/fr-fr/library/ms172240.aspx</a> )</p>
</div>
<br>
<p class=heading>
Edité la dernière fois le
<a href=https://github.com/baywet/blogsource/commit/f1c07980424f8c88fce2580454819da383433fb8>
6 Sep 2021
</a> par <a href=https://github.com/baywet>Vincent Biret</a>
</p>
<br>
<div class=heading>Tags:</div>
<div class="field is-grouped is-grouped-multiline">
<div class=control>
<a href=/fr/tags/build>
<span class=tag>Build</span>
</a>
</div>
<div class=control>
<a href=/fr/tags/alm>
<span class=tag>Alm</span>
</a>
</div>
<div class=control>
<a href=/fr/tags/visual-studio>
<span class=tag>Visual Studio</span>
</a>
</div>
<div class=control>
<a href=/fr/tags/sharepoint>
<span class=tag>Sharepoint</span>
</a>
</div>
</div>
</div>
</section>
<section class=section>
<div class=container>
<div class=level>
<div class=level-left>
<div class=level-item>
<p class="control has-addons">
<a class=button href=https://baywet.github.io/fr/build-automatise-de-solution-s/>
<span class="icon is-small"><i class="fa fa-chevron-left"></i></span>
<span class="is-hidden-touch is-hidden-desktop-only">
Build automatisé de solution SharePoint server (fulltrust) avec visual studio online
</span>
<span class="is-hidden-touch is-hidden-widescreen">
Build automatisé de solution SharePoint server (fulltrust) avec visual...
</span>
<span class="is-hidden-mobile is-hidden-desktop">
Build automatisé de solution SharePoint server...
</span>
<span class=is-hidden-tablet>
Build automatisé de solution SharePoint...
</span>
</a>
</p>
</div>
</div>
<div class=level-right>
<div class=level-item>
<p class="control has-addons">
<a class=button href=https://baywet.github.io/fr/localisation-du-javascript-dun/>
<span class="is-hidden-touch is-hidden-desktop-only">
Localisation du JavaScript d’une solution Full Trust
</span>
<span class="is-hidden-touch is-hidden-widescreen">
Localisation du JavaScript d’une solution Full Trust
</span>
<span class="is-hidden-mobile is-hidden-desktop">
Localisation du JavaScript d’une solution Full...
</span>
<span class=is-hidden-tablet>
Localisation du JavaScript d’une...
</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
</a>
</p>
</div>
</div>
</div>
</div>
<br>
<br>
<div class=container>
<div id=disqus_thread></div>
<script>var disqus_config=function(){this.page.url="https://baywet.github.io/fr/conversion-dun-certificat-prot/",this.page.identifier=window.location.pathname};(function(){var a=document,b=a.createElement('script');b.src='https://baywet.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
</div>
<br>
<div class=container>
<nav class=panel>
<p class=panel-heading>Related</p>
<a class=panel-block href=https://baywet.github.io/fr/localisation-du-javascript-dun/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Localisation du JavaScript d’une solution Full Trust&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/pourquoi-ne-pas-inclure-de-con/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Pourquoi ne pas inclure de contrôles télérik dans vos produits SharePoint ?&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/changement-dans-le-cycle-de-li/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Changement dans le cycle de livraison des CU pour SharePoint&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/ayez-tous-les-outils-dune-star/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Ayez tous les outils d’une startup de première classe en 10 min&nbsp;
<div class=tag>Visual Studio</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/migration-team-foundation-serv/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Migration Team Foundation Server 2010 vers Visual Studio Online : différence de modèle de processus&nbsp;
<div class=tag>Visual Studio</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/office-365-mise-a-disposition/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Office 365 mise à disposition de la roadmap&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/selectionne-pour-le-sharepoint/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Sélectionné pour le SharePoint Saturday New York City !&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/depreciation-des-apps-auto-heb/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Dépréciation des Apps Auto-hébergées&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/petit-msp-devient-grand-mvp/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Petit MSP devient grand MVP&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/remise-a-disposition-du-sp1-po/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Remise à disposition du SP1 pour SharePoint 2013&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/retrait-du-sp1-de-sp2013-sp1/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Retrait du SP1 de SP2013 / SP1 for SP2013 not available anymore&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/donnez-votre-avis-sur-le-rempl/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Donnez votre avis sur le remplaçant d’infopath !&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/les-annonces-marquantes-de-la/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Les annonces marquantes de la SharePoint Conference 2014 pour Office 365&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/webcast-pour-les-itpros-sur-of/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Webcast pour les ITPros sur Office 365&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
<a class=panel-block href=https://baywet.github.io/fr/acces-anonyme-a-une-applicatio/>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Accès anonyme à une application auto-hébergée pour SharePoint&nbsp;
<div class=tag>Sharepoint</div>
</span>
</a>
</nav>
</div>
</section>
<footer class=footer>
<div class=container>
<nav class=level>
</nav>
<nav class=level>
<div class="level-left has-text-centered">
<div class=level-item>
<form class="control has-icons has-icons-right" method=get action=https://bing.com>
<input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span>
</form>
</div>
</div>
<div class="level-right has-text-centered">
<div class=level-item>
<a class=button href=https://baywet.github.io/fr>
<span class=icon><i class="fa fa-home"></i></span>
</a> &nbsp;
<a class=button href>
<span class=icon><i class="fa fa-rss"></i></span>
</a>
</div>
</div>
</nav>
</div>
</footer>
<script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script>
</body>
</html>