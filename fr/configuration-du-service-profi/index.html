<!doctype html><html lang=fr dir=ltr itemscope itemtype=https://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Configuration du service profil utilisateur sous SharePoint 2010/2007</title><meta name=author content="Vincent Biret"><meta name=description content="**
I)       Description du problème
II)     Résolution du problème sous SharePoint 2007
1)      Compte de service de l&rsquo;OWSTIMER
2)      Shared Service Provider
3)      Paramétrage de la partie..."><meta name=generator content="Hugo 0.75.1"><meta itemprop=name content="Configuration du service profil utilisateur sous SharePoint 2010/2007"><meta itemprop=description content="**
I)       Description du problème
II)     Résolution du problème sous SharePoint 2007
1)      Compte de service de l&rsquo;OWSTIMER
2)      Shared Service Provider
3)      Paramétrage de la partie..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Configuration du service profil utilisateur sous SharePoint 2010/2007"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/fr/configuration-du-service-profi/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="**
I)       Description du problème
II)     Résolution du problème sous SharePoint 2007
1)      Compte de service de l&rsquo;OWSTIMER
2)      Shared Service Provider
3)      Paramétrage de la partie..."><meta property="og:site_name" content="Le blog de baywet"><meta property="og:updated_time" content="2020-10-02T07:54:14-04:00"><meta property="article:published_time" content="2010-08-30T16:35:00+00:00"><meta property="article:modified_time" content="2020-10-02T07:54:14-04:00"><meta property="article:section" content><meta property="article:tag" content="service"><meta property="article:tag" content="configure"><meta property="article:tag" content="profile"><meta property="article:tag" content="user"><meta property="article:tag" content="2007"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Configuration du service profil utilisateur sous SharePoint 2010/2007"><meta name=twitter:description content="**
I)       Description du problème
II)     Résolution du problème sous SharePoint 2007
1)      Compte de service de l&rsquo;OWSTIMER
2)      Shared Service Provider
3)      Paramétrage de la partie..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176061333-1','auto');ga('send','pageview');</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/fr><div class="title is-4">&nbsp;Le blog de baywet</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span><span></span><span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=/en>English</a></div></div></div></nav><section class=section style=flex:1><div class=container><h1 class=title>Configuration du service profil utilisateur sous SharePoint 2010/2007</h1><p class=subtitle>Aug 30, 2010</p><div class=content><p>**<img src=./image1.png alt=image1.png></p><p><a href=../configuration-du-service-profi>I)       Description du problème</a></p><p><a href=../configuration-du-service-profi>II)     Résolution du problème sous SharePoint 2007</a></p><p><a href=../configuration-du-service-profi>1)      Compte de service de l&rsquo;OWSTIMER</a></p><p><a href=../configuration-du-service-profi>2)      Shared Service Provider</a></p><p><a href=../configuration-du-service-profi>3)      Paramétrage de la partie Service Profil Utilisateur du SSP</a></p><p><a href=../configuration-du-service-profi>III)         Résolution du problème sous SharePoint 2010</a></p><p><a href=../configuration-du-service-profi>1)      Compte de service de l&rsquo;OWSTIMER</a></p><p><a href=../configuration-du-service-profi>2)      Application de service</a></p><p><a href=../configuration-du-service-profi>3)      Paramétrage de base du Service</a></p><p>•I)                    Description du problème</p><p>De nombreuses solutions et même les sites SharePoint utilisent régulièrement des attributs du profil utilisateur pour rendre l&rsquo;expérience utilisateur la plus agréable possible. Or il se peut que la synchronisation de ces attributs avec SharePoint (depuis l&rsquo;active directory ou depuis d&rsquo;autres WebApp) ne se fasse pas correctement car le Service de Synchronisation de Profil Utilisateur n&rsquo;est pas configuré sur la ferme SharePoint.</p><p>La solution consiste à configurer et mettre en service cette fonctionnalité de SharePoint afin de pouvoir l&rsquo;utiliser.</p><p><em>Note : cet article résout les problèmes de domain\user affiché au lieu du nom d&rsquo;affichage, de la photo et des différences de propriétés entre les diverses webapps.</em></p><p>•II)                  Résolution du problème sous SharePoint 2007</p><p>•1)      Compte de service de l&rsquo;OWSTIMER</p><p>Sous SharePoint 2007 le service Profil Utilisateur est une fonctionnalité dépendant s&rsquo;un Shared Service Provider (SSP) et utilisant des TimerJobs pour se synchroniser avec les sources de données de profils internes et externes.</p><p>Ces TimerJobs nécessitent l&rsquo;utilisation du compte de service administratif de la ferme (et non un compte administrateur, c&rsquo;est le compte qui vous sert de connexion à l&rsquo;instance SQL), le service Windows SharePoint Services Timer doit donc être lancé avec ce compte.</p><p>Pour cela appuyez sur [WINDOWS] + R, entrez services.msc puis validez.</p><p><img src=./image2.png alt=image2.png></p><p>Rendez-vous aux services SharePoint et vérifier que le service Windows SharePoint Services Timer est bien démarré en utilisant le compte de service qui sert de compte de service SharePoint de connexion à l&rsquo;instance SQL configuré avec l&rsquo;assistant de configuration des produits et technologies SharePoint.</p><p>Vérifiez ensuite que ce compte a bien les droits sur la machine, il doit être administrateur local. Pour cela cliquez sur le menu démarrer, clic droit sur My computer -> Manage puis dans l&rsquo;arborescence de gauche System and tools -> Local Users And Groups -> Groups, puis dans le cadre central double cliquez sur « Administrators » et ajoutez le compte de Service de la ferme s&rsquo;il n&rsquo;est pas déjà présent.</p><p>Redémarrez le service Timer.</p><p>•2)      Shared Service Provider</p><p>Démarrez l&rsquo;administration centrale de SharePoint rendez-vous à Application Management -> Manage this Farm&rsquo;s Shared Services et vérifiez qu&rsquo;un SSP est présent.</p><p>Si ce n&rsquo;est pas le cas créez en un en cliquant sur « new SSP »</p><p>Les SSP servent à partager une multitude de données entre les webapplications aussi il est recommandé de prendre le temps de les configurer correctement, nous ne traiterons ici que des paramètres qui nous intéressent.</p><p>Le SSP a besoin de plusieurs collections de sites/applications pour fonctionner :</p><ul><li>Les applications à qui il va servir des données, qui sont déjà créées ou seront créées par la suite.</li><li>La collection de sites contenant le site d&rsquo;administration du SSP, pour plus de sécurité il est conseillé de le placer dans une webapp dédiée</li><li>La collection de sites my site, qui pour plus de flexibilité sera placée dans sa propre webapp</li></ul><p>Nous avons donc besoin de 3 comptes de services :</p><ul><li>Un pour l&rsquo;application d&rsquo;admin du SSP, ce compte ne doit pas être le compte administratif ni un administrateur de la ferme</li><li>Un compte pour l&rsquo;application mysite, idem</li><li>Un compte de service du SSP pour les timerJobs, ce compte doit être le compte administratif de la ferme (celui indiqué lors de la création de la ferme)</li></ul><p>Configurez donc le SSP avec le nom, la collection de sites/webapp d&rsquo;admin, celle de mysite, le compte de service administratif de la ferme&mldr;</p><p>Vous devrez peut être effectuer un iisreset /noforce si vous avez créé des webapp.</p><p>•3)      Paramétrage de la partie Service Profil Utilisateur du SSP</p><p>Une fois le SSP créé rendez-vous sur la page d&rsquo;admin du SSP, pour cela ouvrez l&rsquo;admin centrale de SharePoint et cliquez sur le nom de votre SSP à gauche dans le menu quick launch sous la catégorie « Shared Services Providers ».</p><p>Cliquez sur User Profile and Properties -> Configure Profile Import et configurez la source de données : domaine courant, login par défaut sauf si vous avez une configuration vraiment particulière, pour rappel le compte de service administratif de SharePoint est sensé avoir un droit en lecture/écriture sur le domaine.</p><p>Configurez aussi les périodes d&rsquo;import des données.</p><p>Revenez à la racine du site d&rsquo;admin du SSP et cliquez sur « User Profile and Properties » -> « View Profile Properties » pour configurer les propriétés à configurer. Nous prendrons pour exemple la photo de l&rsquo;utilisateur. Cliquez sur le champ dans la liste puis sur « Edit ».</p><p><img src=./image3.png alt=image3.png></p><p>Hormis les propriétés basiques du champ configurez les propriétés de synchronisation de la manière suivante : source de données -> la source de données correspondant à votre active directory, champ -> thumbnailPhoto dans notre cas, cliquez sur OK.</p><p>La partie Profil Service Utilisateur est configurée sur le SSP, il ne reste plus qu&rsquo;à effectuer une première synchronisation pour cela rendez-vous à la racine du site d&rsquo;admin SSP et cliquez sur « User Profile and Properties » -> « Start Full Import »</p><p>•III)                Résolution du problème sous SharePoint 2010</p><p>•1)      Compte de service de l&rsquo;OWSTIMER</p><p>Sous SharePoint 2010 le Service Profil Utilisateur est une application de Service utilisant des TimerJobs pour se synchroniser avec les sources de données de profils internes et externes.</p><p>Ces TimerJobs nécessitent l&rsquo;utilisation du compte de service administratif de la ferme (et non un compte administrateur), le service SharePoint 2010 Timer doit donc être lancé avec ce compte.</p><p>Pour cela appuyez sur [WINDOWS] + R, entrez services.msc et validez.</p><p><img src=./image4.png alt=image4.png></p><p>Rendez-vous aux services SharePoint et vérifier que le service SharePoint 2010 Timer est bien démarré en utilisant le compte de service qui sert de compte de service SharePoint de connexion à l&rsquo;instance SQL configuré avec l&rsquo;assistant de configuration des produits et technologies SharePoint.</p><p>Vérifiez ensuite que ce compte a bien les droits sur la machine, il doit être administrateur local. Pour cela démarrez le gestionnaire de serveur puis dans l&rsquo;arborescence de gauche Configuration -> Local Users And Groups -> Groups, puis dans le cadre central double cliquez sur « Administrators » et ajoutez le compte de Service de la ferme s&rsquo;il n&rsquo;est pas déjà présent.</p><p>Redémarrez le service Timer.</p><p>•2)      Application de service</p><p>Démarrez l&rsquo;administration centrale de SharePoint, cliquez sur « Manage Service Applications » et vérifier la présence d&rsquo;une application de service profil utilisateur</p><p><img src=./image5.png alt=image5.png></p><p>Si ce n&rsquo;est pas le cas créez-en une.</p><p><img src=./image6.png alt=image6.png></p><p><em>Note le compte de service de cette nouvelle Application ne doit en aucun cas être le compte de service administratif de la ferme (celui de l&rsquo;OWSTIMER), c&rsquo;est un trou de sécurité.</em></p><p>Retournez à la racine de l&rsquo;administration centrale de SharePoint et cliquez sur « Manage Services en Server » vous pouvez constater que le service de synchronisation est en état arrêté.</p><p><img src=./image7.png alt=image7.png></p><p><em>Note s&rsquo;il est bloqué en état de démarrage en cours démarrez la console powershell de SharePoint tapez Get-spserviceinstance, repérez le guid du service en cours de démarrage puis tapez stop-spserviceinstance &lt;guid></em></p><p>Cliquez donc sur start, entrez deux fois le mot de passe du compte de service administratif de la ferme (celui de l&rsquo;owstimer) puis validez.</p><p>Ouvrez une console en mode administratif et entrez iisreset /noforce, puis validez.</p><p><em>Note en vous connectant à l&rsquo;administration centrale et en vous rendant aux timer jobs status vous pourrez voir le job ProfileServiceSynchronizationSetup en train de s&rsquo;exécuter, cela dure de 5 à 30 minutes selon la taille de la ferme SharePoint.</em></p><p>Une fois le timerjob exécuté avec succès vous pouvez retourner à la page des services du serveur pour vérifier que le service en question est bien démarré</p><p>•3)      Paramétrage de base du Service.</p><p>Retournez à la racine de l&rsquo;administration centrale puis sur « manage service applications », cliquez sur votre application de service profil utilisateur (pas sur le lien, juste sur la ligne) puis dans le ribbon sur « Permissions » vérifiez que tous les comptes de service des webapplications publiées sont autorisés à consommer le service</p><p><img src=./image8.png alt=image8.png></p><p>Cliquez ensuite sur « Administrators » dans le ribbon et vérifier que ces mêmes comptes de service ont bien le droit « retrieve people data&mldr; »</p><p><img src=./image9.png alt=image9.png></p><p>Cliquez enfin sur « Manage », puis sur « Configure Synchronization Connections » et enfin sur « Create Connection »</p><p><img src=./image10.png alt=image10.png></p><p>Nous allons configurer une connexion à Active Directory, Renseignez un nom pour la connexion, sélectionnez le type Active Directory, authentification windows puis renseignez un compte et sélectionnez les OU à synchroniser</p><p><em>Note : Le compte doit avoir un accès en lecture/écriture dans l&rsquo;active directory sur tous les objets à synchroniser.</em></p><p><em>Note : Lorsque que vous cliquez sur « Create New Connection » vous pouvez obtenir une alerte vous indiquant que le service profil utilisateur est en cours de synchronisation et qu&rsquo;il faut attendre la fin, vous pouvez vous-même interrompre la synchronisation en cours en revenant sur la page précédente et en cliquant à droite sur stop</em></p><p><img src=./image11.png alt=image11.png></p><p>Une fois cela effectué revenez à la page de gestion de l&rsquo;application de service et cliquez sur « Manage User Properties », rendez-vous à la propriété que vous voulez synchroniser avec un élément externe, ici nous prendront pour exemple la photo de l&rsquo;utilisateur.</p><p><img src=./image12.png alt=image12.png></p><p>Cliquez dessus et cliquez sur Edit.</p><p>Hormis les propriétés basiques configurez les propriétés de synchronisation</p><p><img src=./image13.png alt=image13.png></p><p>Sélectionnez la source (ici notre connexion vers Active directory), l&rsquo;attribut lié (ici thumbnailPhoto pour la photo de l&rsquo;utilisateur) et spécifiez la direction (import pour importer de la source export pour le contraire). Cliquez sur  « Add » la nouvelle propriété de synchronisation vient s&rsquo;ajouter au-dessus.</p><p><em>Note : le choix de la direction dépend de votre infrastructure, on pourrait imaginer un AD où les photos seraient déjà pourvues par la DSI ou bien par un serveur Exchange dans ce cas SharePoint ne ferait qu&rsquo;importer, ou bien au contraire où l&rsquo;on demande à l&rsquo;utilisateur d&rsquo;ajouter sa photo via SharePoint dans ce cas c&rsquo;est le contraire&mldr;</em></p><p>Retournez à la page de configuration de la service Application et cliquez sur « My Site Settings », spécifier un hôte de recherche par défaut et un hôte mysite par défaut existants (ceci permet d&rsquo;intégrer correctement tous les liens de recherche et pointant vers mysite dans toutes les webApps de la ferme SharePoint)</p><p>La configuration complète est terminée.</p><p>Merci à <a href=https://www.calindasoftware.com title="Calinda software">Calinda SoftWare</a> qui m&rsquo;aura demandé de creuser le sujet pour eux lors de mon stage.</p></div><br><p class=heading>Edité la dernière fois le
<a href=https://github.com/baywet/blogsource/commit/d4e6748d9322a50890a514a059d06440ea9862ae>2 Oct 2020</a> par <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/fr/tags/service><span class=tag>Service</span></a></div><div class=control><a href=/fr/tags/configure><span class=tag>Configure</span></a></div><div class=control><a href=/fr/tags/profile><span class=tag>Profile</span></a></div><div class=control><a href=/fr/tags/user><span class=tag>User</span></a></div><div class=control><a href=/fr/tags/2007><span class=tag>2007th</span></a></div><div class=control><a href=/fr/tags/2010><span class=tag>2010th</span></a></div><div class=control><a href=/fr/tags/sharepoint><span class=tag>Sharepoint</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/microsoft-day-a-aix-en-provenc/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span><span class="is-hidden-touch is-hidden-desktop-only">Microsoft Day à Aix en Provence le 30/09/10</span>
<span class="is-hidden-touch is-hidden-widescreen">Microsoft Day à Aix en Provence le 30/09/10</span>
<span class="is-hidden-mobile is-hidden-desktop">Microsoft Day à Aix en Provence le 30/09/10</span>
<span class=is-hidden-tablet>Microsoft Day à Aix en Provence le...</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/le-cloud-computing-oui-mais-p/><span class="is-hidden-touch is-hidden-desktop-only">Le Cloud Computing : oui mais pas pour n’importe qui, n’importe quoi ni n’importe comment.</span>
<span class="is-hidden-touch is-hidden-widescreen">Le Cloud Computing : oui mais pas pour n’importe qui, n’importe quoi ni...</span>
<span class="is-hidden-mobile is-hidden-desktop">Le Cloud Computing : oui mais pas pour n’importe...</span>
<span class=is-hidden-tablet>Le Cloud Computing : oui mais pas pour...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/fr/configuration-du-service-profi/";this.page.identifier=window.location.pathname;};(function(){var d=document,s=d.createElement('script');s.src='https://baywet.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/fr><span class=icon><i class="fa fa-home"></i></span></a>&nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>