<!doctype html><html lang=fr dir=ltr itemscope itemtype=https://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Déploiement de Cloud services Azure via les builds 2015</title><meta name=author content="Vincent Biret"><meta name=description content="Introduction au nouveau système de build
Microsoft a récemment rendu disponible un nouveau modèle de définitions de build avec la version 2015 de Visual studio (les binaires tfs 2015 ne sont pas..."><meta name=generator content="Hugo 0.83.1"><meta itemprop=name content="Déploiement de Cloud services Azure via les builds 2015"><meta itemprop=description content="Introduction au nouveau système de build
Microsoft a récemment rendu disponible un nouveau modèle de définitions de build avec la version 2015 de Visual studio (les binaires tfs 2015 ne sont pas..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Déploiement de Cloud services Azure via les builds 2015"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/fr/deploiement-de-cloud-services/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="Introduction au nouveau système de build
Microsoft a récemment rendu disponible un nouveau modèle de définitions de build avec la version 2015 de Visual studio (les binaires tfs 2015 ne sont pas..."><meta property="og:site_name" content="Le blog de baywet"><meta property="og:updated_time" content="2021-05-27T13:15:10+02:00"><meta property="article:published_time" content="2015-08-04T14:00:00+00:00"><meta property="article:modified_time" content="2021-05-27T13:15:10+02:00"><meta property="article:section" content><meta property="article:tag" content="build"><meta property="article:tag" content="worker role"><meta property="article:tag" content="alm"><meta property="article:tag" content="azure"><meta property="article:tag" content="release pipeline"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Déploiement de Cloud services Azure via les builds 2015"><meta name=twitter:description content="Introduction au nouveau système de build
Microsoft a récemment rendu disponible un nouveau modèle de définitions de build avec la version 2015 de Visual studio (les binaires tfs 2015 ne sont pas..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-176061333-1','auto'),ga('send','pageview')</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/fr><div class="title is-4">&nbsp;Le blog de baywet</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span><span></span><span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=https://baywet.github.io/deploying-cloud-service-via-ne/>English</a></div></div></div></nav><section class=section style=flex:1><div class=container><h1 class=title>Déploiement de Cloud services Azure via les builds 2015</h1><p class=subtitle>Aug 4, 2015</p><div class=content><h2 id=introduction-au-nouveau-système-de-build>Introduction au nouveau système de build</h2><p>Microsoft a récemment rendu disponible un nouveau modèle de définitions de build avec la version 2015 de Visual studio (les binaires tfs 2015 ne sont pas encore disponibles mais le service est déjà présent dans Visual Studio Online).</p><p>Pour rappel, les « anciens » modèles de build étaient basés sur deux éléments :</p><ul><li>Le build process template : en XAML, qui définit les étapes que va suivre la séquence de build</li><li>Le build défintion : qui va servir de liant entre le template, les sources et un ensemble de paramètres.</li></ul><p>Cette méthodologie fournit de nombreuses possibilités pour automatiser votre compilation, packaging, tests unitaires et même dans certains cas les déploiements.</p><p>Les inconvénients principaux restant les suivants :</p><ul><li>Processus uniquement personnalisable avec Visual Studio/.NET, ce qui ne suit pas l’ouverture récente de Microsoft</li><li>Difficile à débugger</li><li>Courbe d’apprentissage assez importante</li></ul><p>De ce fait Microsoft a renommé cette méthodologie « XAML builds » et a livré une nouvelle façon de faire. (actuellement nommée « build definitions » dans l’interface).</p><p>Cette nouvelle méthodologie apporte de nombreux avantages :</p><ul><li>Plus facile à prendre en main</li><li>Plus facilement débuggable</li><li>Editable depuis le portail web (plus besoin de visual studio donc)</li><li>Fournit de nombreuses intégrations avec d’autres outils (gulp, ant, maven…)</li></ul><p>Le fonctionnement principal étant d’enchainer des étapes enfichables (plus de structure complexe de workflow comme avant), c’est assez bien décrit par ici <a href=https://msdn.microsoft.com/en-us/Library/vs/alm/Build/overview>https://msdn.microsoft.com/en-us/Library/vs/alm/Build/overview</a></p><h2 id=rappels-sur-les-cloud-services>Rappels sur les cloud services</h2><p>Parmi les nombreux services fournis par Microsoft Azure on trouve les cloud services (PaaS). Pour faire court, et du point de vue d’un développeur, ce sont des services qui peuvent être modélisés dans Visual Studio et qui se constituent deux types de composants :</p><ul><li>Worker Role : composant servant à faire du traitement lourd, un peu comme un service windows dans son fonctionnement.</li><li>Web Role : composant permettant de développer des applications web. Cependant à moins de contraintes de déploiement/configuration/flexibilité assez particulières, les azure web sites (ou azure web apps) répondent maintenant à 98% du besoin et sont plus simples à déployer.</li></ul><p>Si vous voulez plus d’informations sur le sujet je vous invite à consulter <a href=https://msdn.microsoft.com/en-us/library/azure/jj155995.aspx>https://msdn.microsoft.com/en-us/library/azure/jj155995.aspx</a></p><h2 id=déployer-un-cloud-service-dans-votre-release-pipeline>Déployer un cloud service dans votre release pipeline</h2><p>Maintenant en tant que développeur consciencieux vous souhaitez déployer ce cloud service de manière automatisé en mettant en place un release pipeline. Pour éviter que cet article soit trop long je ne m’étendrai pas sur les nombreux avantages que cela procure par rapport à un build et déploiement à la main.</p><p>Vous avez présentement plusieurs options pour configurer le déploiement automatique :</p><ul><li>Depuis le cloud service sur le portail courant (manage.windowsazure.com) demander à azure de faire la configuration à votre place.</li><li>Le faire à la main.</li></ul><p>Le « problème » avec le premier cas de figure c’est qu’en ce moment Azure va configurer une build « XAML ». C’est amplement suffisant si vous souhaitez uniquement déployer votre cloud service tout seul. Mais admettons que vous ayez d’autres éléments à builder/déployer dans votre solution et/ou que vous souhaitez bénéficier d’intégration avec d’autres outils/services ? Dans ce cas il va être très difficile de concilier build XAML et ces autres éléments (voir impossible dans certains cas de figure).</p><p>Je vais donc vous expliquer comment déployer ce cloud service avec les nouvelles builds de visual studio online. Cet article va être basé sur des éléments puisés dans un article qui explique comment déployer un azure web site avec les nouvelles builds, sur un article qui explique comment déployer des cloud services avec les builds XAML ainsi qu’un peu de recherche de ma part.</p><p><a href=https://msdn.microsoft.com/en-us/Library/vs/alm/Build/azure/index>https://msdn.microsoft.com/en-us/Library/vs/alm/Build/azure/index</a></p><p><a href=https://azure.microsoft.com/en-us/documentation/articles/cloud-services-dotnet-continuous-delivery/>https://azure.microsoft.com/en-us/documentation/articles/cloud-services-dotnet-continuous-delivery/</a></p><p>Je vais présumer que vous avez déjà créé le service de cloud sur azure ainsi qu’un service de stockage. (il est possible d’automatiser cette partie aussi si vous le souhaitez).</p><p>Vous devez aussi être administrateur de votre projet d’équipe et administrateur de la souscription Azure (ou demander à l’admin azure les publishsettings)</p><h3 id=configuration-de-la-connexion-à-azure>Configuration de la connexion à Azure</h3><p>La première étape consiste à dire à visual studio online « hey j’ai une souscription azure sur laquelle tu peux faire des trucs ». Pour cela rendez-vous sur la page de votre projet d’équipe dans visual studio online cliquez sur la roue dentée en haut à droite.</p><p>Puis cliquer sur l’onglet services.</p><p>Add new service connection.</p><p><img src=./85.png alt=85.png></p><p>Ajouter le subscription id, le subscription name, et le subscription certificate que vous pouvez trouver depuis le fichier publish settings. Vous pouvez obtenir ce fichier de plusieurs manières :</p><ul><li>En cliquant sur le lien bleu en bas à droite</li><li>Depuis la console azure powershell</li><li>En allant voir votre admin azure si vous en avez un</li></ul><p>Une vidéo explique comment bien ajouter ces paramètres</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/aLprCE3uRHs style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>Note : je n’ai pas eu de problèmes avec cette étape avec mon compte personnel (live) pour des projets personnels mais il semblerait qu’il y ait un bug si votre souscription Azure est un Enterprise agreement et que vous vous identifiez sur azure avec un compte d’entreprise. Pour contourner ce problème chez Negotium nous avons configuré un déploiement depuis azure ce qui a eu pour effet de créer service automatiquement.</p><h3 id=ajout-de-létape-de-publication>Ajout de l’étape de publication</h3><p>Rendez-vous dans l’onglet « build ». Normalement vous avez déjà créer une nouvelle définition de biuld de type « Visual Studio ». Par défaut 4 étapes sont présentes :</p><ul><li>Visual Studio Build : compilation</li><li>Visual Studio Test : mstest</li><li>Index Sources and Publish symbols : création des symboles de débug</li><li>Publish Build artifacts : rapatrie le produit du processus pour l’archiver avec la build</li></ul><p>Nous allons commencer par éditer la première étape pour ajouter « /t:Publish /p:TargetProfile=Cloud » aux arguments MS Build. Bien entendu « cloud » doit correspondre à un des profils de publication de votre service de cloud ( par défaut cloud et local).</p><p>Ceci va indiquer à visual studio de constituer les packages de déploiements après la compilation.</p><p><img src=./86.png alt=86.png></p><p>Une fois cela effectué nous allons ajouter une cinquième étape en dernier de déploiement de cloud service.</p><p><img src=./87.png alt=87.png></p><p>Pour la souscription, sélectionner celle que vous venez d’ajouter, dans le storage account, entrez le nom de l’espace de stockage qui va servir pour le déploiement. Service Name, le nom du cloud service.</p><p>Pour le cspkg et le csconfig vous avez plusieurs options, ou bien vous pouvez spécifier le chemin complet ou relatif vers les fichiers ou alors vous pouvez spécifier un pattern de recherche. Préférant la précision j’ai rentré :</p><p>$(Agent.BuildDirectory)\artifacts\drop\ImageResizer\bin$(BuildConfiguration)\app.publish\ImageResizer.cspkg</p><p>$(Agent.BuildDirectory)\artifacts\drop\ImageResizer\bin$(BuildConfiguration)\app.publish\ServiceConfiguration.Cloud.cscfg</p><p>“imageResizer” étant le nom de mon projet de cloud service.</p><p>(si vous n’êtes pas sûrs des noms de dossiers/fichiers, lancez une première build et regardez le contenu du drop)</p><p>Pensez bien à activer l’étape, enregistrer et vous êtes prêts à déployer de manière automatique !</p><p><img src=./88.png alt=88.png></p></div><br><p class=heading>Edité la dernière fois le
<a href=https://github.com/baywet/blogsource/commit/212285838725305ed7759bb19c2e84a4aafee591>27 May 2021</a> par <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/fr/tags/build><span class=tag>Build</span></a></div><div class=control><a href=/fr/tags/worker-role><span class=tag>Worker Role</span></a></div><div class=control><a href=/fr/tags/alm><span class=tag>Alm</span></a></div><div class=control><a href=/fr/tags/azure><span class=tag>Azure</span></a></div><div class=control><a href=/fr/tags/release-pipeline><span class=tag>Release Pipeline</span></a></div><div class=control><a href=/fr/tags/d%c3%a9ploiement><span class=tag>Déploiement</span></a></div><div class=control><a href=/fr/tags/process><span class=tag>Process</span></a></div><div class=control><a href=/fr/tags/visual-studio-online><span class=tag>Visual Studio Online</span></a></div><div class=control><a href=/fr/tags/cloud-service><span class=tag>Cloud Service</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/conferencier-au-collab365/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span>
<span class="is-hidden-touch is-hidden-desktop-only">Conférencier au collab365</span>
<span class="is-hidden-touch is-hidden-widescreen">Conférencier au collab365</span>
<span class="is-hidden-mobile is-hidden-desktop">Conférencier au collab365</span>
<span class=is-hidden-tablet>Conférencier au collab365</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/provisionnement-des-services-c/><span class="is-hidden-touch is-hidden-desktop-only">Provisionnement des services customs dans SharePoint</span>
<span class="is-hidden-touch is-hidden-widescreen">Provisionnement des services customs dans SharePoint</span>
<span class="is-hidden-mobile is-hidden-desktop">Provisionnement des services customs dans...</span>
<span class=is-hidden-tablet>Provisionnement des services customs...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/fr/deploiement-de-cloud-services/",this.page.identifier=window.location.pathname};(function(){var a=document,b=a.createElement('script');b.src='https://baywet.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><div class=container><nav class=panel><p class=panel-heading>Related</p><a class=panel-block href=https://baywet.github.io/fr/azure-bug-avec-la-definition/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Azure – Bug avec la définition de paramètres depuis Azure WebSites&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/fr/build-automatise-de-solutions/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Build automatisé de solutions SharePoint (full trust) 2013 – Où sont mes solutions?&nbsp;<div class=tag>Build</div><div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/visual-studio-2013-update-4-et/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Visual Studio 2013 Update 4 et build automatisé de solutions SharePoint (full trust)&nbsp;<div class=tag>Build</div><div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/build-automatise-de-solution-s/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Build automatisé de solution SharePoint server (fulltrust) avec visual studio online&nbsp;<div class=tag>Build</div><div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/conversion-dun-certificat-prot/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Conversion d’un certificat protégé par mot de passe (pfx) en certificat non protégé (snk)&nbsp;<div class=tag>Build</div><div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/changement-dans-le-cycle-de-li/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Changement dans le cycle de livraison des CU pour SharePoint&nbsp;<div class=tag>Déploiement</div></span></a><a class=panel-block href=https://baywet.github.io/fr/ayez-tous-les-outils-dune-star/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Ayez tous les outils d’une startup de première classe en 10 min&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/fr/migration-team-foundation-serv/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Migration Team Foundation Server 2010 vers Visual Studio Online : différence de modèle de processus&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/fr/refonte-des-packs-de-langue-po/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Refonte des packs de langue pour SharePoint 2010&nbsp;<div class=tag>Déploiement</div></span></a><a class=panel-block href=https://baywet.github.io/fr/the-vhd-must-be-stored-as-a-pa-2014-03-05-01-45-11/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>The VHD must be stored as a page blob. Upload a vhd to azure&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/fr/the-vhd-must-be-stored-as-a-pa-2014-03-05-01-40-57/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>The VHD must be stored as a page blob. Uploader un vhd vers azure&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/fr/installation-des-prerequis-sha/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Installation des prérequis SharePoint 2013 sur des serveurs hors ligne&nbsp;<div class=tag>Déploiement</div></span></a><a class=panel-block href=https://baywet.github.io/fr/wcf-entity-framework-code-fir/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>WCF + Entity FrameWork Code First + Azure&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/fr/deployer-son-ou-ses-blogs-blog/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déployer son (ou ses) blog(s) BlogEngine sur Azure&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/fr/sharepoint-auto-upgrade-soluti/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>SharePoint Auto Upgrade Solution&nbsp;<div class=tag>Déploiement</div></span></a></nav></div></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/fr><span class=icon><i class="fa fa-home"></i></span></a> &nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>