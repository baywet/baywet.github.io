<!doctype html><html lang=fr dir=ltr itemscope itemtype=https://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Uploader automatiquement les photos des utilisateurs SharePoint sur leur profil en PowerShell</title><meta name=author content="Vincent Biret"><meta name=description content="Récemment on m’a posé la question suivante au travail (SOGETI) : y-a-t-il un moyen si je possède toutes les photos de mes utilisateurs dans un répertoire, de les pousser sur leur profil en une seule..."><meta name=generator content="Hugo 0.104.2"><meta itemprop=name content="Uploader automatiquement les photos des utilisateurs SharePoint sur leur profil en PowerShell"><meta itemprop=description content="Récemment on m’a posé la question suivante au travail (SOGETI) : y-a-t-il un moyen si je possède toutes les photos de mes utilisateurs dans un répertoire, de les pousser sur leur profil en une seule..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Uploader automatiquement les photos des utilisateurs SharePoint sur leur profil en PowerShell"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/fr/uploader-automatiquement-les-p/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="Récemment on m’a posé la question suivante au travail (SOGETI) : y-a-t-il un moyen si je possède toutes les photos de mes utilisateurs dans un répertoire, de les pousser sur leur profil en une seule..."><meta property="og:site_name" content="Le blog de baywet"><meta property="og:updated_time" content="2022-10-01T14:17:24-04:00"><meta property="article:published_time" content="2011-07-28T12:26:00+00:00"><meta property="article:modified_time" content="2022-10-01T14:17:24-04:00"><meta property="article:section" content><meta property="article:tag" content="automatique"><meta property="article:tag" content="photos"><meta property="article:tag" content="profile"><meta property="article:tag" content="user"><meta property="article:tag" content="upload"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Uploader automatiquement les photos des utilisateurs SharePoint sur leur profil en PowerShell"><meta name=twitter:description content="Récemment on m’a posé la question suivante au travail (SOGETI) : y-a-t-il un moyen si je possède toutes les photos de mes utilisateurs dans un répertoire, de les pousser sur leur profil en une seule..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-176061333-1","auto"),ga("send","pageview")</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/fr><div class="title is-4">&nbsp;Le blog de baywet</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span>
<span></span>
<span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=/en>English</a></div></div></div></nav><section class=section style=flex:1><div class=container><h1 class=title>Uploader automatiquement les photos des utilisateurs SharePoint sur leur profil en PowerShell</h1><p class=subtitle>Jul 28, 2011</p><div class=content><p>Récemment on m’a posé la question suivante au travail (SOGETI) : y-a-t-il un moyen si je possède toutes les photos de mes utilisateurs dans un répertoire, de les pousser sur leur profil en une seule fois ?</p><p><a href=./SPUtils.zip>A cela je réponds oui et vous pourrez trouver mon script ici joint.</a></p><p>Avant tout je vous conseille de lire l’article en Anglais de Chris Johnson qui a déjà bien déblayé le terrain.</p><p><a href=https://blogs.msdn.com/b/cjohnson/archive/2010/05/08/sharepoint-2010-office-2010-and-profile-pictures.aspx>https://blogs.msdn.com/b/cjohnson/archive/2010/05/08/sharepoint-2010-office-2010-and-profile-pictures.aspx</a></p><p>Je commencerai par apporter une précision à son post en indiquant qu’il faut avoir l’autorisation de Full Control sur l’application de service de synchronisation de profil utilisateur sur laquelle vous voulez ajouter des images. (et ce même si vous êtes déjà admin de la ferme sharepoint)</p><p>Pour cela rendez-vous dans l’administration centrale, manage service applications, sélectionnez la ligne de l’application de service profil utilisateur (sans cliquer sur le titre, qui vous enverrait vers les paramètres détaillés du SPU) et dans le ribbon cliquez sur permissions.</p><p>Dans cette nouvelle fenêtre ajoutez le login qui va exécuter le script et cochez full control puis ok.</p><p>Note : si vous obtenez des erreurs lors de l’exécution du script (de type null reference) c’est peut-être parce que ce nouveau paramètre n’est pas encore appliqué, il suffit de faire un iisreset /noforce et de fermer et rouvrir votre console powershell.</p><p><img src=./full_2D00_admin_2D00_spu.png alt=full_2D00_admin_2D00_spu.png></p><p>Il faut aussi que vous soyez farm admin (pour avoir accès au SharePoint Management Shell)</p><p>Parlons maintenant de <a href=./SPUtils.zip>notre script</a> à proprement dit.</p><p>L’étape suivante consiste à déposer dans un répertoire toutes les photos (peu importe le poids, peu importe la taille) nommées de la manière suivante userlogonname.jpg (ou png ou autre, on en parlera plus tard).</p><p>Ensuite créez une doc lib de type Images (pictures) sur un de vos site SharePoint de la ferme, modifiez les permissions pour accorder l’accès aux utilisateurs authentifiés.</p><p>L’intérêt de cette doc lib est tout simplement de pouvoir uploader les images avant de les intégrer au profil de l’utilisateur. Il n’existe pas à ma connaissance de manière simple d’écrire directement l’image dans le profil.</p><p>Le script fonctionne de cette manière, il upload toutes les images sur une doclib, il modifie les propriétés des profils associés et enfin demande à SharePoint d’effectuer le redimensionnement et de l’intégrer directement au sein du profil. Il faut savoir que toutes les images des profils sont finalement stockées en 3 exemplaires de taille différente dans une doc lib d’images sur le mysite.</p><p>Si nous n’envoyons pas directement les images sur la doc lib cachée et par défaut du mysite c&rsquo;est pour ensuite pouvoir utiliser la méthode de redimensionnement automatique fournie par SharePoint.</p><p>Une fois tout cela effectué il suffit de paramétrer le script : (voir à la fin du fichier)</p><p>$directory = &ldquo;C:\Users\weck\Desktop\pics&rdquo;; => repertoire où vous stockez les images</p><p>$photoext = &ldquo;.jpg&rdquo;; => extension des images, on pourra faire plusieurs passes si on a différentes extensions</p><p>$myUrl = &ldquo;https://hulk/my&rdquo;; => url du mysite</p><p>$siteUrl = &ldquo;<a href=https://dev1.dev.local/%22;>https://dev1.dev.local/";</a> => url du site sur lequel vous avez créé la doclib, ne pas oublier le / final</p><p>$libName = &ldquo;Pics&rdquo;; => nom de la doc lib dans laquelle stocker les images</p><p>$List = get-childitem $directory | where {$_.extension -eq $photoext};</p><p>$upm = (GetProfileManager -url $myUrl);</p><p>$domain = &ldquo;DEV&rdquo;; => domaine des utilisateurs (uniquement le nom court, pas le fqdn)</p><p>Sauvegardez le script, lancez-le en mode administratif. Dans la sortie vous verrez à quelle image fait-on correspondre quel utilisateur et si une image n’a pas trouvé de correspondance.</p><p>Voila vos images sont uploadées!</p><p>!<img src=./elladucashprofile.JPG alt=elladucashprofile.JPG></p><p>Notes : Si l’utilisateur n’a jamais créé son profil, il sera créé automatiquement pour lui à partir de ce qui est exploitable dans l’Active Directory.</p><p>Ce script est assez gourmand si on traite un gros volume de données, évitez de l’exécuter aux heures de pointe.</p><p>Une fois l’upload des images effectué et une synchro du service profil utilisateur passée, vous pourrez supprimer la doc lib que vous avez créée pour uploader les images.</p><p>Ce script est perfectible en termes de performances et de mécaniques mais je l’ai laissé assez brut pour que vous puissiez l’adapter facilement aux situations que vous rencontrerez.</p><p>Enjoy !</p></div><br><p class=heading>Edité la dernière fois le
<a href=https://github.com/baywet/blogsource/commit/5eb85fe703904d7842207da379396fd438704e42>1 Oct 2022</a> par <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/fr/tags/automatique><span class=tag>Automatique</span></a></div><div class=control><a href=/fr/tags/photos><span class=tag>Photos</span></a></div><div class=control><a href=/fr/tags/profile><span class=tag>Profile</span></a></div><div class=control><a href=/fr/tags/user><span class=tag>User</span></a></div><div class=control><a href=/fr/tags/upload><span class=tag>Upload</span></a></div><div class=control><a href=/fr/tags/t%c3%a9l%c3%a9chargement><span class=tag>Téléchargement</span></a></div><div class=control><a href=/fr/tags/powershell><span class=tag>Powershell</span></a></div><div class=control><a href=/fr/tags/picture><span class=tag>Picture</span></a></div><div class=control><a href=/fr/tags/sharepoint><span class=tag>Sharepoint</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/reconduite-de-mon-titre-msp/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span>
<span class="is-hidden-touch is-hidden-desktop-only">Reconduite de mon titre MSP</span>
<span class="is-hidden-touch is-hidden-widescreen">Reconduite de mon titre MSP</span>
<span class="is-hidden-mobile is-hidden-desktop">Reconduite de mon titre MSP</span>
<span class=is-hidden-tablet>Reconduite de mon titre MSP</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/upgrade-des-bases-de-donnees-m/><span class="is-hidden-touch is-hidden-desktop-only">Upgrade des bases de données mirrorées avec le SP1 de SharePoint</span>
<span class="is-hidden-touch is-hidden-widescreen">Upgrade des bases de données mirrorées avec le SP1 de SharePoint</span>
<span class="is-hidden-mobile is-hidden-desktop">Upgrade des bases de données mirrorées avec le SP1...</span>
<span class=is-hidden-tablet>Upgrade des bases de données mirrorées...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/fr/uploader-automatiquement-les-p/",this.page.identifier=window.location.pathname};(function(){var e=document,t=e.createElement("script");t.src="https://baywet.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><div class=container><nav class=panel><p class=panel-heading>Related</p><a class=panel-block href=https://baywet.github.io/fr/upgrade-des-bases-de-donnees-m/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Upgrade des bases de données mirrorées avec le SP1 de SharePoint&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/re-realease-de-la-mise-a-jour/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Re-Realease de la mise à jour cumulative de Juin (CU1 June)&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/industrialisation-des-installa-2011-07-06-16-42-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Industrialisation des installations de ferme SharePoint 2010(CU, SP, Langues, SlipStream) Part 3&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/industrialisation-des-installa-2011-07-06-16-11-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Industrialisation des installations de ferme SharePoint 2010(CU, SP, Langues, SlipStream) Part 2&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/industrialisation-des-installa-2011-07-06-15-47-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Industrialisation des installations de ferme SharePoint 2010(CU, SP, Langues, SlipStream) Part 1&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/sp1-pour-sharepoint-2010/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>SP1 pour SharePoint 2010&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/mirroring-sql-et-sharepoint-t/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Mirroring SQL et SharePoint : Tips & Piège&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/webconference-sur-la-securite/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>WebConférence sur la sécurité avec la gamme ForeFront 2010&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/topologie-des-fermes-sharepoin/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Topologie des fermes SharePoint et déploiement de ForeFront Protection for SharePoint&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/vue-densemble-des-services-de/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Vue d’ensemble des services de conversion des documents dans SharePoint 2010&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/requtage-active-directory-depu/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Requêtage Active Directory depuis SharePoint.&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/feedback-msday-aix-en-provence/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Feedback MSDay Aix-En-Provence 30/09/10&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/ajouter-un-nouvel-administrate/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Ajouter un nouvel administrateur de ferme SharePoint pouvant éxécuter la console PowerShell sans encombres&nbsp;<div class=tag>Powershell</div><div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/fr/configuration-du-service-profi/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Configuration du service profil utilisateur sous SharePoint 2010/2007&nbsp;<div class=tag>Profile</div><div class=tag>User</div><div class=tag>Sharepoint</div></span></a></nav></div></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/fr><span class=icon><i class="fa fa-home"></i></span></a> &nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>