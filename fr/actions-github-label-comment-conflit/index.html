<!doctype html><html lang=fr dir=ltr itemscope itemtype=https://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Actions GitHub: étiquetage et commentaire automatique des pull requests en conflit</title><meta name=author content="Vincent Biret"><meta name=description content="Les dépôts open source permettent une productivité considérable dans le développement de logiciels. La croissance de la base d&rsquo;utilisateurs se traduit généralement par une croissance du nombre..."><meta name=generator content="Hugo 0.83.1"><meta itemprop=name content="Actions GitHub: étiquetage et commentaire automatique des pull requests en conflit"><meta itemprop=description content="Les dépôts open source permettent une productivité considérable dans le développement de logiciels. La croissance de la base d&rsquo;utilisateurs se traduit généralement par une croissance du nombre..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Actions GitHub: étiquetage et commentaire automatique des pull requests en conflit"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/fr/actions-github-label-comment-conflit/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="Les dépôts open source permettent une productivité considérable dans le développement de logiciels. La croissance de la base d&rsquo;utilisateurs se traduit généralement par une croissance du nombre..."><meta property="og:site_name" content="Le blog de baywet"><meta property="og:updated_time" content="2021-05-12T08:05:55+02:00"><meta property="article:published_time" content="2020-09-13T14:00:00+00:00"><meta property="article:modified_time" content="2021-05-12T08:05:55+02:00"><meta property="article:section" content><meta property="article:tag" content="build"><meta property="article:tag" content="ci"><meta property="article:tag" content="alm"><meta property="article:tag" content="github"><meta property="article:tag" content="oss"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Actions GitHub: étiquetage et commentaire automatique des pull requests en conflit"><meta name=twitter:description content="Les dépôts open source permettent une productivité considérable dans le développement de logiciels. La croissance de la base d&rsquo;utilisateurs se traduit généralement par une croissance du nombre..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-176061333-1','auto'),ga('send','pageview')</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/fr><div class="title is-4">&nbsp;Le blog de baywet</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span><span></span><span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=https://baywet.github.io/pull-request-conflict-github-workflow/>English</a></div></div></div></nav><section class=section style=flex:1><div class=container><h1 class=title>Actions GitHub: étiquetage et commentaire automatique des pull requests en conflit</h1><p class=subtitle>Sep 13, 2020</p><div class=content><p>Les dépôts open source permettent une productivité considérable dans le développement de logiciels. La croissance de la base d&rsquo;utilisateurs se traduit généralement par une croissance du nombre de contributeurs, qui à son tour se traduit par une meilleure solution apportant plus d&rsquo;utilisateurs, etc. <strong>La maintenance de grands dépôts open source peut prendre du temps</strong> car vous passez de plus en plus de temps à revoir des contributions. Ne vous méprenez pas, ce temps passé à examiner les pull requests est généralement bien investi car il représente un facteur de gain: pour des minutes passées à revoir une pull request donnée, la base de code bénéficie d&rsquo;heures d&rsquo;efforts de développement investis par le contributeur.</p><p>Parce que les gens choisissent de consacrer leur temps à contribuer à votre projet, temps qu&rsquo;ils pourraient utiliser d&rsquo;un million d&rsquo;autres façons, <strong>vous voulez vous assurer que leur pull request est <em>examiné</em> dès que possible</strong>, et leur faire savoir dès qu&rsquo;un problème surgit. Une expérience de revue fluide garantit non seulement que la pull request finira par être intégrée, mais elle encourage également les contributeurs à soumettre plus de pull requests à l&rsquo;avenir. Par la même occasion, vous devriez utiliser autant d&rsquo;outils que possible pour éviter <a href="https://www.bing.com/search?q=open+source+maintainer+burnout">l&rsquo;épuisement des responsables open source</a>. Vous savez peut-être déjà que j&rsquo;aime vraiment automatiser autant de travail trivial que possible afin de pouvoir passer mon temps sur des tâches à valeur ajoutée.</p><p><strong>Un problème qu&rsquo;une pull request peut rencontrer est un conflit d&rsquo;intégration</strong>. Supposons qu&rsquo;Alice et Bob aient tous deux des idées brillantes à ajouter à votre projet, à peu près au même moment. Ils ont tous deux dupliqué le dépôt et ont commencé à travailler. Alice a été plus rapide pour terminer sa pull request et l&rsquo;a soumise en premier, rapidement suivie par Bob. Ils ont tous deux introduit des changements dans les fichiers qui sont en conflit les uns avec les autres (modifié les mêmes lignes). Vous commencez par examiner la pull request d&rsquo;Alice, c&rsquo;est parfait, et vous décidez de la fusionner tout de suite. Maintenant, votre attention est requise ailleurs et vous ne regardez pas celle de Bob.</p><p><strong>Il est généralement admis que les contributeurs doivent soumettre des pull requests propres</strong> (pas de conflits, le code compile et passe les tests unitaires, atomique, la documentation mise à jour&mldr;) et ils doivent maintenir la pull request dans un état propre jusqu&rsquo;à ce qu&rsquo;elle soit fusionnée. La pull request de Bob affichera l&rsquo;état suivant, exigeant que les conflits soient résolus avant de pouvoir être integrée dans la base de code.</p><p><img src=./conflicting-PR-status.png alt="état de conflit de pull request"></p><p>Ce statut n&rsquo;envoie aucune notification au contributeur et n&rsquo;affiche rien sur aucune liste. Cela rend <strong>difficile pour vous, en tant que mainteneur, d&rsquo;identifier en un coup d&rsquo;œil quelles pull requests sont en conflit</strong> afin que vous puissiez vous concentrer sur la revue de celles qui sont prêtes. Cela peut également <strong>bloquer la pull request</strong> à moins que Bob ne vienne vérifier sa pull request et pourquoi elle n&rsquo;a pas encore été fusionnée ou <strong>à moins que vous ne preniez le temps de laisser un commentaire</strong> demandant à Bob de résoudre les conflits.</p><p>Ce point de friction et de latence peut facilement être amélioré via l&rsquo;automatisation à l&rsquo;aide des <a href=https://github.com/features/actions>actions GitHub</a>. Ce flux de travail est actuellement utilisé par le <a href=https://github.com/microsoftgraph/microsoft-graph-docs>dépôt de documentation Microsoft Graph</a> et par certains dépôts Microsoft Graph SDK. Il se déclenche sur les mise à jour de la branche principale ainsi que sur les pull requests ciblant la branche principale et utilise l&rsquo;action <a href=https://github.com/eps1lon/actions-label-merge-conflict>eps1lon/actions-label-merge-conflict</a> pour:</p><ol><li>Identifier les pull requests qui sont désormais en conflit/ne sont plus en conflit en fonction de la dernière mise à jour.</li><li>Ajouter/supprimer automatiquement des étiquettes en fonction de ces informations afin qu&rsquo;il vous soit plus facile d&rsquo;identifier en un coup d&rsquo;œil les pull requests qui sont en conflit.</li><li>Commenter automatiquement en fonction des informations afin que les contributeurs reçoivent une notification.</li></ol><p>Vous pouvez voir que les pull requests en conflit sont beaucoup plus faciles à identifier (et même à filtrer) lorsque vous examinez toutes les pull requests sur le dépôt.</p><p><img src=./conflicting-PR-summary.png alt="état des pull requests en conflit"></p><p>Voici un exemple de ce à quoi ressemble un message pour une pull request en conflit.</p><p><img src=./conflicting-PR-message.png alt="message de pull request en conflit"></p><p>Enfin, voici l&rsquo;exemple de workflow. Vous devez placer ce fichier sous <code>/.github/workflows/unnom.yml</code> dans votre dépôt et vous pouvez bien sûr le modifier à votre convenance.</p><blockquote><p><strong>Remarque:</strong> vous vous demandez peut-être pourquoi ce flux de travail se déclenche en mode push. C&rsquo;est parce que le <code>GITHUB_TOKEN</code> pour les pull requests provenant de copies (forks) aura des autorisations en lecture seule, ce qui l&rsquo;empêche d&rsquo;étiqueter et/ou de commenter les problèmes. L&rsquo;action examine toutes les pull requests ouvertes chaque fois qu&rsquo;elle est déclenchée par push.</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=color:#f92672>name</span>: <span style=color:#ae81ff>PullRequestConflicting</span>

<span style=color:#75715e># Controls when the action will run. Triggers the workflow on push or pull request</span>
<span style=color:#75715e># events but only for the master branch</span>
<span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>master, dev ]</span>
  <span style=color:#f92672>pull_request</span>:
    <span style=color:#f92672>types</span>: [<span style=color:#ae81ff>synchronize]</span>
    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>master, dev ]</span>

<span style=color:#75715e># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span>
<span style=color:#f92672>jobs</span>:
  <span style=color:#75715e># This workflow contains a single job called &#34;build&#34;</span>
  <span style=color:#f92672>build</span>:
    <span style=color:#75715e># The type of runner that the job will run on</span>
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>

    <span style=color:#75715e># Steps represent a sequence of tasks that will be executed as part of the job</span>
    <span style=color:#f92672>steps</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>check if prs are dirty</span>
      <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>eps1lon/actions-label-merge-conflict@releases/2.x</span>
      <span style=color:#f92672>if</span>: <span style=color:#ae81ff>env.LABELING_TOKEN != &#39;&#39; &amp;&amp; env.LABELING_TOKEN != null</span>
      <span style=color:#f92672>id</span>: <span style=color:#ae81ff>check</span>
      <span style=color:#f92672>with</span>:
        <span style=color:#f92672>dirtyLabel</span>: <span style=color:#e6db74>&#34;conflicting&#34;</span>
        <span style=color:#f92672>repoToken</span>: <span style=color:#e6db74>&#34;${{ secrets.GITHUB_TOKEN  }}&#34;</span>
        <span style=color:#f92672>continueOnMissingPermissions</span>: <span style=color:#66d9ef>true</span>
        <span style=color:#f92672>commentOnDirty</span>: <span style=color:#e6db74>&#39;This pull request has conflicting changes, the author must resolve the conflicts before this pull request can be merged.&#39;</span>
        <span style=color:#f92672>commentOnClean</span>: <span style=color:#e6db74>&#39;Conflicts have been resolved. A maintainer will take a look shortly.&#39;</span>
      <span style=color:#f92672>env</span>:
        <span style=color:#f92672>LABELING_TOKEN</span>: <span style=color:#ae81ff>${{secrets.GITHUB_TOKEN }}</span>
</code></pre></div></div><br><p class=heading>Edité la dernière fois le
<a href=https://github.com/baywet/blogsource/commit/dd888105b92cc29e0be856ae8ab2492f078f3351>12 May 2021</a> par <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/fr/tags/build><span class=tag>Build</span></a></div><div class=control><a href=/fr/tags/ci><span class=tag>Ci</span></a></div><div class=control><a href=/fr/tags/alm><span class=tag>Alm</span></a></div><div class=control><a href=/fr/tags/github><span class=tag>Github</span></a></div><div class=control><a href=/fr/tags/oss><span class=tag>Oss</span></a></div><div class=control><a href=/fr/tags/github><span class=tag>Github</span></a></div><div class=control><a href=/fr/tags/actions><span class=tag>Actions</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/experience-role-gestionnaire-programme-retour-dev/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span>
<span class="is-hidden-touch is-hidden-desktop-only">Mon expérience personnelle en tant que gestionnaire de programme et retour au développement</span>
<span class="is-hidden-touch is-hidden-widescreen">Mon expérience personnelle en tant que gestionnaire de programme et retour...</span>
<span class="is-hidden-mobile is-hidden-desktop">Mon expérience personnelle en tant que...</span>
<span class=is-hidden-tablet>Mon expérience personnelle en tant que...</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/fr/sessions-msbuild-2020-msgraph/><span class="is-hidden-touch is-hidden-desktop-only">Microsoft Build 2020 enregistrement des sessions Microsoft Graph disponibles</span>
<span class="is-hidden-touch is-hidden-widescreen">Microsoft Build 2020 enregistrement des sessions Microsoft Graph...</span>
<span class="is-hidden-mobile is-hidden-desktop">Microsoft Build 2020 enregistrement des sessions...</span>
<span class=is-hidden-tablet>Microsoft Build 2020 enregistrement des...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/fr/actions-github-label-comment-conflit/",this.page.identifier=window.location.pathname};(function(){var a=document,b=a.createElement('script');b.src='https://baywet.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><div class=container><nav class=panel><p class=panel-heading>Related</p><a class=panel-block href=https://baywet.github.io/fr/update-sonarqube-endpoints-e/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Update : SonarQube : Endpoints et tâches&nbsp;<div class=tag>Build</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-12-02-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 14 - Conclusion&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-30-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 13 - Bonus configuration de l’extension SonarLint&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-28-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 12 - Contrôle des résultats&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-25-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 12 - Mise à jour de votre définition de build&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-23-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 11 - Ajout du projet SonarQube&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-21-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 10 - Création d’un compte de service et référencement dans VSTS&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-18-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 9 - Configuration d’Azure Active directory pour l’authentification&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-16-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 8 - Ajout de modules&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-14-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 7 - Installation de la machine&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-11-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 6 - Création de la base de données&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-09-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 5 - Ouverture du port de SonarQube&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-07-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 4 - Provisionnement de la VM SonarQube&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-04-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 3 - La topologie&nbsp;<div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/fr/determinez-votre-dette-techniq-2016-11-02-14-00-00/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Déterminez votre dette technique à l’aide de SonarQube : 2 - Analyse Statique&nbsp;<div class=tag>Alm</div></span></a></nav></div></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/fr><span class=icon><i class="fa fa-home"></i></span></a> &nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>