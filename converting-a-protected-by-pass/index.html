<!doctype html><html lang=en dir=ltr itemscope itemtype=https://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Converting a protected by password certificate (pfx) to an unprotected one (snk)</title><meta name=author content="Vincent Biret"><meta name=description content="At work I am trying to implement automated build for SharePoint (full trust) projects on visual studio online. (Expect to have several articles about this as and when I meet and solve errors)
When..."><meta name=generator content="Hugo 0.102.3"><meta itemprop=name content="Converting a protected by password certificate (pfx) to an unprotected one (snk)"><meta itemprop=description content="At work I am trying to implement automated build for SharePoint (full trust) projects on visual studio online. (Expect to have several articles about this as and when I meet and solve errors)
When..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Converting a protected by password certificate (pfx) to an unprotected one (snk)"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/converting-a-protected-by-pass/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="At work I am trying to implement automated build for SharePoint (full trust) projects on visual studio online. (Expect to have several articles about this as and when I meet and solve errors)
When..."><meta property="og:site_name" content="Baywet's blog"><meta property="og:updated_time" content="2022-09-04T12:33:25-04:00"><meta property="article:published_time" content="2014-10-04T01:06:37+00:00"><meta property="article:modified_time" content="2022-09-04T12:33:25-04:00"><meta property="article:section" content><meta property="article:tag" content="build"><meta property="article:tag" content="alm"><meta property="article:tag" content="visual studio"><meta property="article:tag" content="sharepoint"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Converting a protected by password certificate (pfx) to an unprotected one (snk)"><meta name=twitter:description content="At work I am trying to implement automated build for SharePoint (full trust) projects on visual studio online. (Expect to have several articles about this as and when I meet and solve errors)
When..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-176061333-1","auto"),ga("send","pageview")</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/en><div class="title is-4">&nbsp;Baywet's blog</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span>
<span></span>
<span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=https://baywet.github.io/fr/conversion-dun-certificat-prot/>Français</a></div></div></div></nav><section class=section style=flex:1><div class=container><h1 class=title>Converting a protected by password certificate (pfx) to an unprotected one (snk)</h1><p class=subtitle>Oct 4, 2014</p><div class=content><p>At work I am trying to implement <strong>automated build for SharePoint</strong> (full trust) projects on visual studio online. (Expect to have several articles about this as and when I meet and solve errors)</p><p>When doing SharePoint development <strong>we have to sign assemblies with a certificate</strong>. When the project is initialized there are two options:</p><ul><li>Certificate is protected by a password: (pfx extension) that was with first versions of SharePoint tooling, or if you have created the structure of (visual studio) solution yourself with several assemblies.</li><li>Certificate is not protected: (snk extension) default option of the tooling for a few years</li></ul><p><strong>In my case the certificate was protected by a password</strong> which causes the following problem: that you have to type this password when you want to build the source on a new machine for the first time. This is really not convenient when doing automated build (no human to type a password when building). <strong>This gives us this error message.</strong></p><p><em>Cannot import the following key file: cert.pfx. The key file may be password protected. To correct this, try to import the certificate again or manually install the certificate to the Strong Name CSP with the following key container name: VS_KEY_XXXXXXXXXXXXXXX</em></p><p>It is even worse when you try to configure it with the build hosted machines. <strong>These machines are machines pre configured by Microsoft to avoid having to setup your own build machine</strong>. (you cannot access it).</p><p><strong>The msbuild framework does not provide a simple way to configure the password</strong> and the command line tool sn.exe (used to import the certificates in the store of the machine) also prompts for the password. In fact it makes sense: <strong>a password should be memorized and never written down</strong> (security 101).</p><p>So I had to <strong>delete the password for the certificate</strong>, only the <strong>visual studio interface</strong> does <strong>not allow us to do this</strong>. The only solution is to <strong>generate a new certificate in this case</strong>? Certainly not! This will <strong>change the public key of the assembly</strong> and potentially cause problems for all the items saved in database after the update! (I’m particularly thinking about the event receivers).</p><p>The solution? <strong>Convert the certificate using a little bit of code</strong> (running it in a console app) found on pastebin <a href=https://pastebin.com/dpMxqsK4>https://pastebin.com/dpMxqsK4</a></p><p>X509Certificate2 cert = new X509Certificate2(@&ldquo;KEY.pfx&rdquo;, &ldquo;pfxPassword&rdquo;, X509KeyStorageFlags.Exportable |) X509KeyStorageFlags.PersistKeySet);</p><p>RSACryptoServiceProvider provider = (RSACryptoServiceProvider) cert.PrivateKey;</p><p>Byte [] array = provider.ExportCspBlob(!provider.)PublicOnly);</p><p>using (FileStream fs = new FileStream (&ldquo;FileName.snk&rdquo;, FileMode.Create, FileAccess.Write))</p><p>{</p><p>FS.Write(array, 0, array.)Length);</p><p>}</p><p>Hoping it makes you save time in implementing your automated builds with visual studio online.</p><p>PS: Ideally your company should buy a public intermediate authority certificate and setup a PKI. From this PKI you should generate your password-protected certificates. These certificates should be imported once (via GPO if possible) on the developers and the build machines. This would:</p><ul><li>keep the private key protected even in case of theft of the sources</li><li>not require you to give the password to developers or to put it in a script anymore</li><li>allow your customers to ensure that the assembly they receive is published by you and not by an attacker</li><li>implement the automated build (on your machines only not the one provided by VS online)</li></ul><p>(see authenticode <a href=https://msdn.microsoft.com/fr-fr/library/ms172240.aspx>https://msdn.microsoft.com/fr-fr/library/ms172240.aspx</a> )</p></div><br><p class=heading>Last edited
<a href=https://github.com/baywet/blogsource/commit/1d6ea33bb6f8a391d52838bca18c48631507ebac>Sep 4, 2022</a> by <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/tags/build><span class=tag>Build</span></a></div><div class=control><a href=/tags/alm><span class=tag>Alm</span></a></div><div class=control><a href=/tags/visual-studio><span class=tag>Visual Studio</span></a></div><div class=control><a href=/tags/sharepoint><span class=tag>Sharepoint</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/speaking-at-the-sharepoint-sat-2014-10-08-23-40-00/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span>
<span class="is-hidden-touch is-hidden-desktop-only">Speaking at the SharePoint Saturday Ottawa 2014 !</span>
<span class="is-hidden-touch is-hidden-widescreen">Speaking at the SharePoint Saturday Ottawa 2014 !</span>
<span class="is-hidden-mobile is-hidden-desktop">Speaking at the SharePoint Saturday Ottawa 2014 !</span>
<span class=is-hidden-tablet>Speaking at the SharePoint Saturday...</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/speaking-at-the-sharepoint-sat-2014-10-01-23-34-03/><span class="is-hidden-touch is-hidden-desktop-only">Speaking at the SharePoint Saturday New Hampshire 2014 !</span>
<span class="is-hidden-touch is-hidden-widescreen">Speaking at the SharePoint Saturday New Hampshire 2014 !</span>
<span class="is-hidden-mobile is-hidden-desktop">Speaking at the SharePoint Saturday New Hampshire...</span>
<span class=is-hidden-tablet>Speaking at the SharePoint Saturday New...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/converting-a-protected-by-pass/",this.page.identifier=window.location.pathname};(function(){var e=document,t=e.createElement("script");t.src="https://baywet.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><div class=container><nav class=panel><p class=panel-heading>Related</p><a class=panel-block href=https://baywet.github.io/speaking-at-the-sharepoint-sat-2014-10-01-23-34-03/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Speaking at the SharePoint Saturday New Hampshire 2014 !&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/localizing-javascript-of-a-ful/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Localizing JavaScript of a Full Trust solution&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/why-should-you-not-include-tel/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Why should you not include telerik controls in your SharePoint products?&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/have-all-the-tools-of-a-first/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Have all the tools of a first class startup's in 10 min&nbsp;<div class=tag>Visual Studio</div></span></a><a class=panel-block href=https://baywet.github.io/migrating-team-foundation-serv/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Migrating Team Foundation Server 2010 to Visual Studio Online: difference of process model&nbsp;<div class=tag>Visual Studio</div></span></a><a class=panel-block href=https://baywet.github.io/the-roadmap-for-office-365-is/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>The roadmap for Office 365 is available&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/selected-for-sharepoint-saturd/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Selected for SharePoint Saturday New York City&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/auto-hosted-applications-are-d/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Auto-hosted applications are deprecated&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/the-former-msp-becomes-mvp/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>The former MSP becomes MVP&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/write-a-review-on-infopaths-re/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Write a review on infopath’s replacer!&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/outstanding-announcements-of-t/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Outstanding announcements of the SharePoint Conference 2014 for Office 365&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/anonymous-access-for-sharepoin/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Anonymous access for SharePoint autohosted apps&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/operating-system-compatibility/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Operating system compatibility of SharePoint 2010/2013 has evolved&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/repackaging-of-sharepoint-2010/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Repackaging of SharePoint 2010 language packs&nbsp;<div class=tag>Sharepoint</div></span></a><a class=panel-block href=https://baywet.github.io/march-update-of-visual-studio/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>March Update of Visual Studio tools for Office&nbsp;<div class=tag>Visual Studio</div><div class=tag>Sharepoint</div></span></a></nav></div></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/en><span class=icon><i class="fa fa-home"></i></span></a> &nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>