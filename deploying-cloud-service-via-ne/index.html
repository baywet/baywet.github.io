<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Deploying cloud service via new 2015 build templates</title><meta name=author content="Vincent Biret"><meta name=description content="Introduction to the new build system
Microsoft recently made a new build definitions model with the release of Visual Studio 2015 (TFS 2015’s bits are not yet available but this new build service is..."><meta name=generator content="Hugo 0.74.3"><meta itemprop=name content="Deploying cloud service via new 2015 build templates"><meta itemprop=description content="Introduction to the new build system
Microsoft recently made a new build definitions model with the release of Visual Studio 2015 (TFS 2015’s bits are not yet available but this new build service is..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Deploying cloud service via new 2015 build templates"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/deploying-cloud-service-via-ne/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="Introduction to the new build system
Microsoft recently made a new build definitions model with the release of Visual Studio 2015 (TFS 2015’s bits are not yet available but this new build service is..."><meta property="og:site_name" content="Baywet's blog"><meta property="og:updated_time" content="2020-09-05T13:58:36-04:00"><meta property="article:published_time" content="2015-08-04T14:00:00+00:00"><meta property="article:modified_time" content="2020-09-05T13:58:36-04:00"><meta property="article:section" content><meta property="article:tag" content="build"><meta property="article:tag" content="worker role"><meta property="article:tag" content="alm"><meta property="article:tag" content="azure"><meta property="article:tag" content="deployment"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Deploying cloud service via new 2015 build templates"><meta name=twitter:description content="Introduction to the new build system
Microsoft recently made a new build definitions model with the release of Visual Studio 2015 (TFS 2015’s bits are not yet available but this new build service is..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176061333-1','auto');ga('send','pageview');</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/en><div class="title is-4">&nbsp;Baywet's blog</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span><span></span><span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=https://baywet.github.io/fr/deploiement-de-cloud-services/>Français</a></div></div></div></nav><section class=section style=flex:1><div class=container><p class=title>Deploying cloud service via new 2015 build templates</p><p class=subtitle>Aug 4, 2015</p><div class=content><h1 id=introduction-to-the-new-build-system>Introduction to the new build system</h1><p>Microsoft recently made a new build definitions model with the release of Visual Studio 2015 (TFS 2015’s bits are not yet available but this new build service is already available on Visual Studio Online).</p><p>Just as a reminder the “old” build models were based on two artifacts:</p><ul><li>The build process template: defined via XAML, it allows you to configure the sequence for the build process.</li><li>The build definition: links together the template, sources and some settings.</li></ul><p>This methodology offers a wide range of possibilities to automate your build, packaging, testing and even deployment.</p><p>But this comes with a few disadvantages:</p><ul><li>The build process can only be customized via Visual Studio/.NET, this doesn’t go along with Microsoft’s new openness.</li><li>Hard to debug</li><li>Important learning curve</li></ul><p>For this reason, Microsoft renamed this methodology “XAML builds” and delivered a new way to build your applications (currently named “build definition” in the interface).</p><p>This new methodology has a lot of advantages:</p><ul><li>Easier to understand</li><li>Easier to debug</li><li>Can be edited via the web portal (no need of Visual Studio anymore)</li><li>Provides a lot of third parties integrations (gulp, ant, maven…)</li></ul><p>The only drawback being you can only have sequential steps, no complex workflow anymore, here is some documentation: <a href=https://msdn.microsoft.com/en-us/Library/vs/alm/Build/overview>https://msdn.microsoft.com/en-us/Library/vs/alm/Build/overview</a></p><h1 id=reminders-on-cloud-services>Reminders on cloud services</h1><p>Among the various services offered by Microsoft Azure, you’ll find the cloud services (Paas). As a short recap and from a developer’s point of view, those can be designed from Visual Studio and are made of two types of components:</p><ul><li>Worker role: component meant to do the heavy lifting, similar to a windows service in it’s behavior.</li><li>Web Role: component allowing us to build web applications. However use those only if you have peculiar constraints in terms of deployment/configuration/scalability. Azure web sites (or now azure web apps) cover 98% of what they do and are really simpler to deploy.</li></ul><p>If you want more information about it: <a href=https://msdn.microsoft.com/en-us/library/azure/jj155995.aspx>https://msdn.microsoft.com/en-us/library/azure/jj155995.aspx</a></p><h1 id=deploying-a-cloud-service-from-your-release-pipeline>Deploying a cloud service from your release pipeline</h1><p>Now as a conscientious developer, you’d like to deploy this cloud service automatically setting up a release pipeline. To avoid writing a way too long post, I’m not going to enumerate all the advantages a release pipeline brings compared to a manual build and deployment process.</p><p>You currently have two ways of setting up the automatic deployment:</p><ul><li>From the cloud service on the current portal (windows.azure.com), there is an option to configure everything for you.</li><li>Set up everything manually</li></ul><p>The “issue” with the automatic method is that Azure is going to configure a “XAML” build. It’s OK if you only want to deploy the cloud service, but let’s say you have other items to build/deploy within your solution or that you want to integrate third party tools? In that case it’s going to be very difficult to accommodate XAML builds and these other items (or even impossible in some cases).</p><p>I’m going to explain you how to deploy your cloud services automatically with the new build service of Visual Studio Online. This post is going to be based on time I spent searching and on two other ones, one explaining how to manually configure the XAML builds to deploy, another one explaining how to configure the new builds but for azure web sites.</p><p><a href=https://msdn.microsoft.com/en-us/Library/vs/alm/Build/azure/index>https://msdn.microsoft.com/en-us/Library/vs/alm/Build/azure/index</a></p><p><a href=https://azure.microsoft.com/en-us/documentation/articles/cloud-services-dotnet-continuous-delivery/>https://azure.microsoft.com/en-us/documentation/articles/cloud-services-dotnet-continuous-delivery/</a></p><p>I’ll assume you already have created the cloud service and a storage account. (you can also automate that part if you want to do so).</p><p>You also have to be the administrator (or co admin) of your subscription on Azure (or ask your admin publish settings file) and administrator of your team project on VSO.</p><h2 id=configuring-the-service-connection-to-azure>Configuring the service connection to Azure</h2><p>This first step mainly consists in saying to visual studio online “hey I have an azure subscription other there that you can use to do stuffs”. To do so go to your team’s project main page and click on the gear (top right corner).</p><p>Click on the services tab then on add a new service connection.</p><p><img src=./89.png alt=89.png></p><p>Add the subscription id, name and certificate that you can find from the publish settings file. You can get this file multiple ways:</p><ul><li>Clicking on the blue link bottom right corner</li><li>From the Azure powershell console</li><li>Asking you azure administrator (if you have one)</li></ul><p>Here is a video that explains how to configure these settings.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/aLprCE3uRHs style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>Note: for this step I had no issues with my personal live account but it seems that if your azure subscription is under an enterprise agreement and if you’re logged in using a corporate account, you might have troubles. To workaround this issue at Negotium we configured a deployment from the azure portal which added the service connection at the same time.</p><h2 id=adding-the-publishing-step>Adding the publishing step</h2><p>Let’s go to the “build” tab of your team’s project, you should already have created a new build definition of type “visual studio”. By default 4 steps are configured:</p><ul><li>Visual Studio Build: actually builds the code</li><li>Visual Studio Test: for those familiar, mstest</li><li>Index and Publish sources: creates debug symbols and packages these.</li><li>Publish build artifacts: brings back the ouput of the process and archives it with the build</li></ul><p>We’ll begin by editing the first step to add these arguments to the msbuild process « /t:Publish /p:TargetProfile=Cloud ». “cloud” must be the name of one of my cloud service publishing profiles (by default cloud and local).</p><p>This will instruct msbuild to make publishing packages after building.</p><p><img src=./90.png alt=90.png></p><p>That being done, we’ll add a last 5th step to our build process of type azure cloud service deployment.</p><p><img src=./91.png alt=91.png></p><p>Select the subscription you just added, add the storage account name you want to use for the deployment and the cloud service name.</p><p>For the cscfg and cspkg you have two different options, either you can specify a relative or full path or you can specify a powershell search pattern. Preferring precision I set:</p><p>$(Agent.BuildDirectory)\artifacts\drop\ImageResizer\bin$(BuildConfiguration)\app.publish\ImageResizer.cspkg</p><p>$(Agent.BuildDirectory)\artifacts\drop\ImageResizer\bin$(BuildConfiguration)\app.publish\ServiceConfiguration.Cloud.cscfg</p><p>“imageResizer” being the name of my cloud service project.</p><p>(if you’re not sure of the files/folers names just build once and have a look to the drop’s content)</p><p>Don’t forget to enable this step and you’re all set!</p><p><img src=./92.png alt=92.png></p></div><br><p class=heading>Last edited
<a href=https://github.com/baywet/blogsource/commit/b3a3b09ed7503d8172da0dd6a4744736eb9c17fc>Sep 5, 2020</a> by <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/tags/build><span class=tag>Build</span></a></div><div class=control><a href=/tags/worker-role><span class=tag>Worker Role</span></a></div><div class=control><a href=/tags/alm><span class=tag>Alm</span></a></div><div class=control><a href=/tags/azure><span class=tag>Azure</span></a></div><div class=control><a href=/tags/deployment><span class=tag>Deployment</span></a></div><div class=control><a href=/tags/release-pipeline><span class=tag>Release Pipeline</span></a></div><div class=control><a href=/tags/process><span class=tag>Process</span></a></div><div class=control><a href=/tags/visual-studio-online><span class=tag>Visual Studio Online</span></a></div><div class=control><a href=/tags/cloud-service><span class=tag>Cloud Service</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/speaker-at-collab365/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span><span class="is-hidden-touch is-hidden-desktop-only">Speaker at Collab365</span>
<span class="is-hidden-touch is-hidden-widescreen">Speaker at Collab365</span>
<span class="is-hidden-mobile is-hidden-desktop">Speaker at Collab365</span>
<span class=is-hidden-tablet>Speaker at Collab365</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/provisioning-custom-services-f/><span class="is-hidden-touch is-hidden-desktop-only">Provisioning custom services for SharePoint</span>
<span class="is-hidden-touch is-hidden-widescreen">Provisioning custom services for SharePoint</span>
<span class="is-hidden-mobile is-hidden-desktop">Provisioning custom services for SharePoint</span>
<span class=is-hidden-tablet>Provisioning custom services for...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/deploying-cloud-service-via-ne/";this.page.identifier=window.location.pathname;};(function(){var d=document,s=d.createElement('script');s.src='https://baywet.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><div class=container><nav class=panel><p class=panel-heading>Related</p><a class=panel-block href=https://baywet.github.io/azure-bug-with-azure-web-site/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Azure – Bug with azure web sites settings&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/maintaining-your-tech-skills-a/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Maintaining your tech skills and free cinema&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/automated-build-for-sharepoint-2014-12-04-01-12-13/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Automated build for SharePoint 2013 full trust solutions – Where are my solutions?&nbsp;<div class=tag>Build</div><div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/visual-studio-2013-update-4-an/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Visual studio 2013 Update 4 and SharePoint full trust solutions automated build&nbsp;<div class=tag>Build</div><div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/automated-build-for-sharepoint-2014-10-29-02-22-54/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Automated build for SharePoint server (fulltrust) solutions with visual studio online&nbsp;<div class=tag>Build</div><div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/converting-a-protected-by-pass/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Converting a protected by password certificate (pfx) to an unprotected one (snk)&nbsp;<div class=tag>Build</div><div class=tag>Alm</div></span></a><a class=panel-block href=https://baywet.github.io/have-all-the-tools-of-a-first/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Have all the tools of a first class startup's in 10 min&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/migrating-team-foundation-serv/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Migrating Team Foundation Server 2010 to Visual Studio Online: difference of process model&nbsp;<div class=tag>Azure</div></span></a><a class=panel-block href=https://baywet.github.io/repackaging-of-sharepoint-2010/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Repackaging of SharePoint 2010 language packs&nbsp;<div class=tag>Deployment</div></span></a><a class=panel-block href=https://baywet.github.io/managing-resources-how-to-make/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Managing Resources, how to make your SharePoint solutions “globally deployed”&nbsp;<div class=tag>Deployment</div></span></a></nav></div></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/en><span class=icon><i class="fa fa-home"></i></span></a>&nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>