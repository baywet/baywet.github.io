<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Controlled update of SQL databases Schema with Entity Framework Code First in a continous delivery process</title><meta name=author content="Vincent Biret"><meta name=description content="Introduction
Entity Framework is a well-known technology in the ORM domain for the .NET world.
Note: Object Relational Mapping, this is the part between data persistence unit and some more “high..."><meta name=generator content="Hugo 0.74.3"><meta itemprop=name content="Controlled update of SQL databases Schema with Entity Framework Code First in a continous delivery process"><meta itemprop=description content="Introduction
Entity Framework is a well-known technology in the ORM domain for the .NET world.
Note: Object Relational Mapping, this is the part between data persistence unit and some more “high..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Controlled update of SQL databases Schema with Entity Framework Code First in a continous delivery process"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/controlled-update-of-sql-datab/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="Introduction
Entity Framework is a well-known technology in the ORM domain for the .NET world.
Note: Object Relational Mapping, this is the part between data persistence unit and some more “high..."><meta property="og:site_name" content="Baywet's blog"><meta property="og:updated_time" content="2020-09-05T10:38:32-04:00"><meta property="article:published_time" content="2016-03-03T14:00:00+00:00"><meta property="article:modified_time" content="2020-09-05T10:38:32-04:00"><meta property="article:section" content><meta property="article:tag" content="entity framework"><meta property="article:tag" content="update"><meta property="article:tag" content="build"><meta property="article:tag" content="database"><meta property="article:tag" content="release"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Controlled update of SQL databases Schema with Entity Framework Code First in a continous delivery process"><meta name=twitter:description content="Introduction
Entity Framework is a well-known technology in the ORM domain for the .NET world.
Note: Object Relational Mapping, this is the part between data persistence unit and some more “high..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176061333-1','auto');ga('send','pageview');</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/en><div class="title is-4">&nbsp;Baywet's blog</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span><span></span><span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=https://baywet.github.io/fr/mise-a-jour-maitrisee-de-schem/>Français</a></div></div></div></nav><section class=section style=flex:1><div class=container><p class=title>Controlled update of SQL databases Schema with Entity Framework Code First in a continous delivery process</p><p class=subtitle>Mar 3, 2016</p><div class=content><h2 id=introduction>Introduction</h2><p>Entity Framework is a well-known technology in the ORM domain for the .NET world.</p><p>Note: Object Relational Mapping, this is the part between data persistence unit and some more “high level” code.</p><p>When you start a new entity framework project you have a few different ways to do it, one of which being “code first”. It means our code will drive the SQL Schema evolution (which simplifies a lot of things and allows you to focus on business and not technical implementation).</p><p>When you chose this approach you have a few methods to run the update of your schema:</p><ul><li><p>Nuget or DNS console, a developer has to do it manually during deployment</p></li><li><p>Auto Migration, entity framework will update the database automatically at runtime when the application starts if it finds differences. This is really useful for small projects but it brings some bad sides: performances are degraded during application startup, you’re not in control anymore of “when” the update is going to happen.</p></li></ul><p>Because we’re developers and really lazy people , because we want to avoid errors, oversights, save time to everybody, we’re going to automate the process while keeping it under control.</p><p>Following examples will be for DNX projects but classic .NET projects are really similar, just the commands change a little bit.</p><p>Note: this post assumes you’ve followed something similar to that article in setting up your dbcontext</p><p><a href=https://docs.efproject.net/en/latest/platforms/aspnetcore/new-db.html>https://docs.efproject.net/en/latest/platforms/aspnetcore/new-db.html</a></p><h2 id=build-or-release-process>Build or release process?</h2><p>In our case we’re using Visual Studio Team Services software industry for our software developments. Some of the provided services are build services and release management services.</p><p>In our case we have a real decoupling between our build and our release processes.</p><p><strong>Build process is responsible for:</strong></p><ul><li><p>Transforming source code to deliverables (compilation, transpilation…)</p></li><li><p>Transmitting additional release artifacts (scripts)</p></li><li><p>Run unit tests</p></li></ul><p><strong>Release management process is responsible for:</strong></p><ul><li><p>Deploying deliverables to target environments</p></li><li><p>Data migration</p></li><li><p>Environments setup and configuration</p></li><li><p>…</p></li></ul><p>Which explains why it makes sense in our case to put the database update process in our release process. Depending on how you set up your continuous delivery process it may differ a little bit and you may have to adapt examples.</p><h2 id=configuring-definitions-in-vsts>Configuring definitions in VSTS</h2><h3 id=script-that-will-run-the-update>Script that will run the update</h3><p>The first thing we’re going to want to add to our “code” is a script which will tell DNX to run the database update and a configuration source file which will allow to configure the db context.</p><p>It’s your lucky day because I’ve already done that for you, here are my gists</p><p><a href=https://gist.github.com/baywet/9931ba2f45043dba9bdb>https://gist.github.com/baywet/9931ba2f45043dba9bdb</a></p><p><a href=https://gist.github.com/baywet/ad41ccb8ad0bb12184ae>https://gist.github.com/baywet/ad41ccb8ad0bb12184ae</a></p><h3 id=getting-the-sources-and-the-scripts>Getting the sources and the scripts</h3><p>What must be understood is that DNX will use the source code and build it live in order to run the database update, I’m not aware of any way to do that from an already compiled DNX library (really just a nuget) available now.</p><p>What it means is we’ll need the sources to do the entity framework database update. Source that are already at hand if you’re doing that in the build process. In our case thought we’re updating the database schema from the release process. So you’ll need to bring your sources with your build artifacts.</p><p>To do so edit your build process and in “copy files” add two lines:</p><ul><li><p>src\** for sources (our sources are in the folder src, which is a standard for DNX projects)</p></li><li><p>*.ps1 to bring the script we just added</p></li></ul><p><img src=./64.png alt=64.png></p><h3 id=updating-the-schema-during-deployment>Updating the schema during deployment</h3><p>Last step is to update your deployment process to tell it to run the entity framework database update. To do so just add a powershell step and configure it to run the script we just added.</p><p>As argument give it the connection script you want to use for the database to be updated.</p><p><img src=./65.png alt=65.png></p><h2 id=conclusion>Conclusion</h2><p><img src=./66.png alt=66.png></p><p>As you can see it’s pretty easy to automate and master the database update of an entity framework code first project with a release pipeline. And that with or without DNX involved.</p><p>I hope this post will save you guys time and deployments issues.</p></div><br><p class=heading>Last edited
<a href=https://github.com/baywet/blogsource/commit/f5dc8541f1028b123b0669de44c5a86a1bf7f7e1>Sep 5, 2020</a> by <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/tags/entity-framework><span class=tag>Entity Framework</span></a></div><div class=control><a href=/tags/update><span class=tag>Update</span></a></div><div class=control><a href=/tags/build><span class=tag>Build</span></a></div><div class=control><a href=/tags/database><span class=tag>Database</span></a></div><div class=control><a href=/tags/release><span class=tag>Release</span></a></div><div class=control><a href=/tags/vsts><span class=tag>Vsts</span></a></div><div class=control><a href=/tags/code-first><span class=tag>Code First</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/speaking-at-sharepoint-saturda-2016-03-30-15-36-54/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span><span class="is-hidden-touch is-hidden-desktop-only">Speaking at SharePoint Saturday Montréal 2016</span>
<span class="is-hidden-touch is-hidden-widescreen">Speaking at SharePoint Saturday Montréal 2016</span>
<span class="is-hidden-mobile is-hidden-desktop">Speaking at SharePoint Saturday Montréal 2016</span>
<span class=is-hidden-tablet>Speaking at SharePoint Saturday Montréal...</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/units-tests-using-xunit-and-vi/><span class="is-hidden-touch is-hidden-desktop-only">Units tests using xUnit and Visual Studio Team Services for DNX projects</span>
<span class="is-hidden-touch is-hidden-widescreen">Units tests using xUnit and Visual Studio Team Services for DNX projects</span>
<span class="is-hidden-mobile is-hidden-desktop">Units tests using xUnit and Visual Studio Team...</span>
<span class=is-hidden-tablet>Units tests using xUnit and Visual...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/controlled-update-of-sql-datab/";this.page.identifier=window.location.pathname;};(function(){var d=document,s=d.createElement('script');s.src='https://baywet.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><div class=container><nav class=panel><p class=panel-heading>Related</p><a class=panel-block href=https://baywet.github.io/units-tests-using-xunit-and-vi/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Units tests using xUnit and Visual Studio Team Services for DNX projects&nbsp;<div class=tag>Build</div><div class=tag>Vsts</div></span></a><a class=panel-block href=https://baywet.github.io/building-dnx-projects-using-ho/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Building DNX projects using home installed build agent (TFS, VSTS)&nbsp;<div class=tag>Build</div><div class=tag>Vsts</div></span></a><a class=panel-block href=https://baywet.github.io/automatically-increment-sharep/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Automatically increment SharePoint feature version number during build with build 2015&nbsp;<div class=tag>Build</div></span></a><a class=panel-block href=https://baywet.github.io/deploying-cloud-service-via-ne/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Deploying cloud service via new 2015 build templates&nbsp;<div class=tag>Build</div></span></a><a class=panel-block href=https://baywet.github.io/automated-build-for-sharepoint-2014-12-04-01-12-13/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Automated build for SharePoint 2013 full trust solutions – Where are my solutions?&nbsp;<div class=tag>Build</div></span></a><a class=panel-block href=https://baywet.github.io/visual-studio-2013-update-4-an/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Visual studio 2013 Update 4 and SharePoint full trust solutions automated build&nbsp;<div class=tag>Build</div></span></a><a class=panel-block href=https://baywet.github.io/office-developers-tools-novemb/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Office developers tools november 2014 update&nbsp;<div class=tag>Update</div></span></a><a class=panel-block href=https://baywet.github.io/automated-build-for-sharepoint-2014-10-29-02-22-54/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Automated build for SharePoint server (fulltrust) solutions with visual studio online&nbsp;<div class=tag>Build</div></span></a><a class=panel-block href=https://baywet.github.io/converting-a-protected-by-pass/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Converting a protected by password certificate (pfx) to an unprotected one (snk)&nbsp;<div class=tag>Build</div></span></a><a class=panel-block href=https://baywet.github.io/operating-system-compatibility/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Operating system compatibility of SharePoint 2010/2013 has evolved&nbsp;<div class=tag>Update</div></span></a><a class=panel-block href=https://baywet.github.io/entity-framework-and-dataconte/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span><span>&nbsp;</span>
<span>Entity Framework and dataContext reference for a web application&nbsp;<div class=tag>Entity Framework</div></span></a></nav></div></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/en><span class=icon><i class="fa fa-home"></i></span></a>&nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>