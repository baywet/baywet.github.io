<!doctype html><html lang=en dir=ltr itemscope itemtype=https://schema.org/Article><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Lessons learned from API client generation - 04 Type and format</title><meta name=author content="Vincent Biret"><meta name=description content="Third pattern of our series looking at how we could improve the OpenAPI specification for the purpose of code generation. Today we’ll look at type and formats which are crucial to generate accurate..."><meta name=generator content="Hugo 0.104.2"><meta itemprop=name content="Lessons learned from API client generation - 04 Type and format"><meta itemprop=description content="Third pattern of our series looking at how we could improve the OpenAPI specification for the purpose of code generation. Today we’ll look at type and formats which are crucial to generate accurate..."><meta itemprop=image content="/img/logo.svg"><meta property="og:title" content="Lessons learned from API client generation - 04 Type and format"><meta property="og:type" content="article"><meta property="og:url" content="https://baywet.github.io/lessons-from-api-client-generation-type-format/"><meta property="og:image" content="/img/logo.svg"><meta property="og:description" content="Third pattern of our series looking at how we could improve the OpenAPI specification for the purpose of code generation. Today we’ll look at type and formats which are crucial to generate accurate..."><meta property="og:site_name" content="Baywet's blog"><meta property="og:updated_time" content="2022-10-01T14:17:24-04:00"><meta property="article:published_time" content="2022-10-01T10:23:00+00:00"><meta property="article:modified_time" content="2022-10-01T14:17:24-04:00"><meta property="article:section" content><meta property="article:tag" content="kiota"><meta property="article:tag" content="OpenAPI"><meta property="article:tag" content="REST"><meta property="article:tag" content="JSON Schema"><meta property="article:tag" content="ASC 2022 session rundown"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:title content="Lessons learned from API client generation - 04 Type and format"><meta name=twitter:description content="Third pattern of our series looking at how we could improve the OpenAPI specification for the purpose of code generation. Today we’ll look at type and formats which are crucial to generate accurate..."><meta name=twitter:creator content><meta name=twitter:image:src content="/img/logo.svg"><link rel=stylesheet type=text/css href=/css/capsule.min.css><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-176061333-1","auto"),ga("send","pageview")</script><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.ico></head><body style=min-height:100vh;display:flex;flex-direction:column><nav class="navbar has-shadow is-white" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=/en><div class="title is-4">&nbsp;Baywet's blog</div></a><label class="button navbar-burger is-white" for=navbar-burger-state><span></span>
<span></span>
<span></span></label></div><input type=checkbox id=navbar-burger-state><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=/fr>Français</a></div></div></div></nav><section class=section style=flex:1><div class=container><h1 class=title>Lessons learned from API client generation - 04 Type and format</h1><p class=subtitle>Oct 1, 2022</p><div class=content><p>Third pattern of <a href=https://baywet.github.io/tags/asc-2022-session-rundown/>our series</a> looking at how we could improve the OpenAPI specification for the purpose of code generation. Today we’ll look at type and formats which are crucial to generate accurate and useful clients.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>components</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>schemas</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Model</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>properties</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>noType</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>properties</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>subProp</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>impossibleCombination</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>format</span>: <span style=color:#ae81ff>int32</span>
</span></span></code></pre></div><p>In the snippet above, for the first example properties are defined, which hints the type should be an object, but the type property is not set to object.
The second example is an impossible combination that’s allowed because the JSON schema specification <a href=https://json-schema.org/draft/2020-12/json-schema-validation.html#name-vocabularies-for-semantic-c>does not mandate any validation of the format</a> property. If we dive deeper into this aspect, we find that a lot of type combinations are considered valid by conventions, but there’s no central registry to date, although OpenAPI <a href=https://spec.openapis.org/registry/format/>is working on one</a>:</p><table><thead><tr><th>Type</th><th>Format values</th></tr></thead><tbody><tr><td>string</td><td>commonmark, html, date-time, duration, date, time, base64url, uuid, ""</td></tr><tr><td>string (not supported by kiota)</td><td>email, idn-email, hostname, idn-hostname, ipv4, ipv6, uri, uri-reference, iri, iri-reference, uri-template, json-pointer, relative-json-pointer, regex</td></tr><tr><td>number</td><td>float, double, decimal, <em>int32, int64, int8, uint8</em>, ""</td></tr><tr><td>integer</td><td><em>int32, int64, int8, uint8</em></td></tr><tr><td>boolean</td><td>""</td></tr><tr><td>""</td><td>byte, binary (technically invalid according to the JSON schema spec)</td></tr><tr><td>file</td><td>""</td></tr><tr><td>array</td><td>""</td></tr><tr><td>object</td><td>""</td></tr><tr><td>null</td><td>""</td></tr></tbody></table><p>From this list we can already notice there is overlap between integer and number.</p><h2 id=suggestions>Suggestions</h2><p>This one is not going to be an easy fix, but we can improve the situation. We should start by removing integer from the options valid for type and add the well known formats options in the JSON schema core vocabulary. This is going to be breaking change for some descriptions.
We could even introduce a “simple” format value for string, and outlaw not having a format for string, and number. We might also want to introduce a “raw” type to support the byte and binary formats. If we did all of that, there would be no more valid case for not having the type property set.
Linters will be a great help if they could add the following rules:</p><ul><li>Error when the format property is used while the type property is any of object, array, null, Boolean, file.</li><li>Error when using the integer type.</li><li>Error when a known format is used with a type it doesn’t belong to.</li><li>Warn when a type that supports a format does not have a format described.</li><li>Error when the type property is not set.</li></ul></div><br><p class=heading>Last edited
<a href=https://github.com/baywet/blogsource/commit/5eb85fe703904d7842207da379396fd438704e42>Oct 1, 2022</a> by <a href=https://github.com/baywet>Vincent Biret</a></p><br><div class=heading>Tags:</div><div class="field is-grouped is-grouped-multiline"><div class=control><a href=/tags/kiota><span class=tag>Kiota</span></a></div><div class=control><a href=/tags/openapi><span class=tag>Open API</span></a></div><div class=control><a href=/tags/rest><span class=tag>Rest</span></a></div><div class=control><a href=/tags/json-schema><span class=tag>JSON Schema</span></a></div><div class=control><a href=/tags/asc-2022-session-rundown><span class=tag>Asc 2022 Session Rundown</span></a></div></div></div></section><section class=section><div class=container><div class=level><div class=level-left><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/lessons-from-api-client-generation-naming-conventions/><span class="icon is-small"><i class="fa fa-chevron-left"></i></span>
<span class="is-hidden-touch is-hidden-desktop-only">Lessons learned from API client generation - 05 Naming conventions</span>
<span class="is-hidden-touch is-hidden-widescreen">Lessons learned from API client generation - 05 Naming conventions</span>
<span class="is-hidden-mobile is-hidden-desktop">Lessons learned from API client generation - 05...</span>
<span class=is-hidden-tablet>Lessons learned from API client...</span></a></p></div></div><div class=level-right><div class=level-item><p class="control has-addons"><a class=button href=https://baywet.github.io/lessons-from-api-client-generation-collections/><span class="is-hidden-touch is-hidden-desktop-only">Lessons learned from API client generation - 03 Collections</span>
<span class="is-hidden-touch is-hidden-widescreen">Lessons learned from API client generation - 03 Collections</span>
<span class="is-hidden-mobile is-hidden-desktop">Lessons learned from API client generation - 03...</span>
<span class=is-hidden-tablet>Lessons learned from API client...</span>
<span class="icon is-small"><i class="fa fa-chevron-right"></i></span></a></p></div></div></div></div><br><br><div class=container><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://baywet.github.io/lessons-from-api-client-generation-type-format/",this.page.identifier=window.location.pathname};(function(){var e=document,t=e.createElement("script");t.src="https://baywet.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><div class=container><nav class=panel><p class=panel-heading>Related</p><a class=panel-block href=https://baywet.github.io/lessons-from-api-client-generation-collections/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Lessons learned from API client generation - 03 Collections&nbsp;<div class=tag>Kiota</div><div class=tag>Open API</div><div class=tag>Rest</div><div class=tag>JSON Schema</div><div class=tag>Asc 2022 Session Rundown</div></span></a><a class=panel-block href=https://baywet.github.io/lessons-from-api-client-generation-enums/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Lessons learned from API client generation - 02 Enumerations&nbsp;<div class=tag>Kiota</div><div class=tag>Open API</div><div class=tag>Rest</div><div class=tag>JSON Schema</div><div class=tag>Asc 2022 Session Rundown</div></span></a><a class=panel-block href=https://baywet.github.io/lessons-from-api-client-generation-intro/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Lessons learned from API client generation - 01 Introduction&nbsp;<div class=tag>Kiota</div><div class=tag>Open API</div><div class=tag>Rest</div><div class=tag>JSON Schema</div><div class=tag>Asc 2022 Session Rundown</div></span></a><a class=panel-block href=https://baywet.github.io/speaking-at-cdc-2022/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Speaking at Caribbean Developer Conference 2022&nbsp;<div class=tag>Kiota</div><div class=tag>Open API</div></span></a><a class=panel-block href=https://baywet.github.io/speaking-at-collabdays-belgium-2022/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Speaking at CollabDays Belgium 2022&nbsp;<div class=tag>Kiota</div><div class=tag>Open API</div></span></a><a class=panel-block href=https://baywet.github.io/speaking-at-api-specification-conf-2022/><span class="icon is-small"><i class="fa fa-chevron-right"></i></span>
<span>&nbsp;</span>
<span>Speaking at the API specification conference 2022&nbsp;<div class=tag>Kiota</div><div class=tag>Open API</div><div class=tag>JSON Schema</div></span></a></nav></div></section><footer class=footer><div class=container><nav class=level></nav><nav class=level><div class="level-left has-text-centered"><div class=level-item><form class="control has-icons has-icons-right" method=get action=https://bing.com><input class=input type=text name=q maxlength=255 placeholder=Search>
<input class=input type=hidden name=sites value=https://baywet.github.io/>
<span class="icon is-small is-right"><i class="fa fa-search"></i></span></form></div></div><div class="level-right has-text-centered"><div class=level-item><a class=button href=https://baywet.github.io/en><span class=icon><i class="fa fa-home"></i></span></a> &nbsp;
<a class=button href><span class=icon><i class="fa fa-rss"></i></span></a></div></div></nav></div></footer><script id=dsq-count-scr src=//baywet.disqus.com/count.js async></script></body></html>